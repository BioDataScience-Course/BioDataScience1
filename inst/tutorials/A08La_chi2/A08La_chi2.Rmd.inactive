---
title: "Test Chi2 univari√©"
author: "Guyliann Engels & Philippe Grosjean"
description: "**SDD I Module 8** Distribution du Chi2, et test Chi2 univari√©."
tutorial:
  id: "A08La_chi2"
  version: 2.1.1/9
output:
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
BioDataScience1::learnr_setup()
SciViews::R("infer")
library(BioDataScience1)
```

```{r, echo=FALSE}
BioDataScience1::learnr_banner()
```

```{r, context="server"}
BioDataScience1::learnr_server(input, output, session)
```

------------------------------------------------------------------------

## Objectifs

La loi de distribution du $\chi^2$ repr√©sente de mani√®re th√©orique la probabilit√© de distribution de fr√©quences entre les niveaux d'une ou plusieurs variables qualitatives. Un test d'hypoth√®se $\chi^2$ en est d√©riv√© pour comparer un √©chantillon √† des valeurs th√©oriques sous H~0~. Vos objectifs sont ici de¬†:

-   Pouvoir calculer des quantiles ou des probabilit√©s relatifs √† la distribution du $\chi^2$

-   Appr√©hender le test d'hypoth√®se du $\chi^2$ univari√©

Vous devez avoir assimil√© la mati√®re du [module 8](https://wp.sciviews.org/sdd-umons/?iframe=wp.sciviews.org/sdd-umons-2022/chi2.html) du cours, en particulier la [section 8.2](https://wp.sciviews.org/sdd-umons/?iframe=wp.sciviews.org/sdd-umons-2022/test-dhypoth%25C3%25A8se.html), et vous devez avoir compris les diff√©rentes notions vue au [module 7](https://wp.sciviews.org/sdd-umons/?iframe=wp.sciviews.org/sdd-umons-2022/proba.html) relatives au calcul de probabilit√©s et aux lois de distribution statistiques. Ce learnr vous sert √† auto-√©valuer vos acquis relatifs √† la distribution $\chi^2$ et au test $\chi^2$ univari√©.

## Distribution du $\chi^2$

Repr√©sentez graphiquement la densit√© de probabilit√© de la distribution du $\chi^2$ √† trois degr√©s de libert√©. Utilisez la fonction approri√©e `dist_*()`.

```{r chi_dist_h1, exercise=TRUE, exercise.lines=4}
# Distribution de chi2 avec 3 degr√©s de libert√©
chi <- ___(df = ___)
# Graphique de la distribution
___(chi)
```

```{r chi_dist_h1-solution}
## Solution ##
# Distribution de chi2 avec 3 degr√©s de libert√©
chi <- dist_chisq(df = 3)
# Graphique de la distribution
chart(chi)
```

```{r chi_dist_h1-check}
grade_code("Avec les fonctions `dist_*()`, il est simple de cr√©er un objet repr√©sentant la distribution souhait√©e. Pour la distribution du Chi^2, il vous suffit d'indiquer les degr√©s de libert√© de la distribution. Il s'agit d'une loi de distribution tr√®s asym√©trique et qui commence √† {0, 0}. Notez que plus le quantile est grand, plus la densit√© de probabilit√© est faible.")
```

Sur base de cette distribution √† trois degr√©s de libert√©, calculez la probabilit√© d'une valeur de $\chi^2$ sup√©rieure au quantile 15.

<!-- üí¨ **Ce code correspond au snippet `.icproba`.** -->

```{r chi1_h2, exercise=TRUE}
pchisq(___, df = ___, lower.tail = ___)
```

```{r chi1_h2-hint-1}
pchisq(15, df = ___, lower.tail = ___)

 #### ATTENTION: Hint suivant = solution !####
```

```{r chi1_h2-solution}
## Solution ##
pchisq(15, df = 3, lower.tail = FALSE)
```

```{r chi1_h2-check}
grade_code("La fonction `pchisq()` calcule une probabilit√© √† partir d'un quantile selon la distribution Chi^2.")
```

Toujours sur base de cette distribution √† trois degr√©s de libert√©, calculez le quantile qui d√©limite l'aire √† droite dont la probabilit√© est de 5%.

<!-- üí¨ **Ce code correspond au snippet `.icquant`.** -->

```{r chi2_h2, exercise=TRUE}
qchisq(___, df = ___, lower.tail = ___)
```

```{r chi2_h2-hint-1}
qchisq(0.05, df = ___, lower.tail = ___)

 #### ATTENTION: Hint suivant = solution !####
```

```{r chi2_h2-solution}
## Solution ##
qchisq(0.05, df = 3, lower.tail = FALSE)
```

```{r chi2_h2-check}
grade_code("La fonction `qchisq()` calcule un quantile d√©limitant une aire qui correspond √† une probabilit√© donn√©e selon la distribution Chi^2.")
```

## Calcul du $\chi^2_{obs}$

![](images/chimpanze.jpg)

Une exp√©rience vise √† d√©terminer les pr√©f√©rences alimentaires des chimpanz√©s. On propose √† 45 chimpanz√©s trois fruits diff√©rents comme source de nourriture. Pour chacun, on note leur premier choix. Voici les r√©sultats obtenus¬†:

```{r, echo=TRUE}
chimp <- dtx(Pomme = 16, Banane = 22, Orange = 7)
knitr::kable(chimp)
```

Ce sont nos **fr√©quences observ√©es** $a_i$. Si les chimpanz√©s n'ont pas de pr√©f√©rence alimentaire, les **probabilit√©s** de choix pour chaque fruit devraient √™tre identiques¬†:

```{r, echo=TRUE}
chimp_proba <- dtx(Pomme = 1/3, Banane = 1/3, Orange = 1/3)
knitr::kable(chimp_proba)
```

Multipliez les probabilit√©s de chaque fruit par le nombre d'observations totales (donc de chimpanz√©s) pour obtenir les **fr√©quences th√©oriques** $\alpha_i$¬†:

```{r qu_freq}
question("Quelles sont les fr√©quences th√©oriques sous l'hypoth√®se nulle que les chimpanz√©s n'ont pas de pr√©f√©rence alimentaire ?)",
  answer("pommes = 15 | bananes = 15 | oranges = 15", correct = TRUE),
  answer("pommes = 5.3 | bananes = 7.4 | oranges = 2.3"),
  answer("pommes = 17 | bananes = 18 | oranges = 10"),
  allow_retry = TRUE, random_answer_order = TRUE,
  incorrect = "Recommencez afin de trouver la bonne r√©ponse",
  correct = "C'est correct ! Ce sont les fr√©quences th√©oriques sont l'hypoth√®se qu'il n'y a pas de diff√©rences sont les probabilit√©s multipli√©es par l'effectif total.")
```

Calculez √† la main la valeur du $\chi^2$ observ√© √† l'aide de la formule (aidez-vous d'une calculette)¬†:

$\chi^2_{obs} = \sum_i\frac{(a_i - \alpha_i)^2}{\alpha_i}$

```{r qu_chi2_obs}
question("Valeur du Chi^2 observ√©.",
  answer("7.601", correct = TRUE),
  answer("4.267"),
  answer("0.067"),
  allow_retry = TRUE, random_answer_order = TRUE,
  incorrect = "Recommencez afin de trouver la bonne r√©ponse",
  correct = "C'est correct ! Ceci est la valeur du quantile Chi^2 correspondant √† notre √©chantillon.")
```

## Test du $\chi^2$ univari√©

Donc, pour notre exp√©rience de pr√©f√©rences alimentaires des chimpanz√©s, nous avions les donn√©es suivantes (fr√©quences observ√©es)¬†:

```{r}
knitr::kable(chimp)
```

Or, sous H~0~ de non pr√©f√©rences alimentaires, nous nous attendions √† observer √† peu pr√®s le m√™me nombre de premiers choix pour chaque fruit. Ces √©cart sont-ils r√©v√©lateurs de pr√©f√©rences marqu√©es, ou peuvent-il √™tre obtenus par le biais du hasard¬†? Pour le v√©rifier, nous avions calcul√© la valeur du $\chi^2_{obs}$ comme √©tant 7.601.

Cette valeur doit maintenant √™tre confront√©e √† la distribution th√©orique du $\chi^2$ √† deux degr√©s de libert√© (nombre de niveaux de la variable qualitative `fruit` moins un, donc ici (3 - 1) = 2) repr√©sent√©e ci-dessous.

$ddl = nombre \ de \ niveaux \ de \ la \ variable -1$

```{r}
# Chi-square distribution (density probability) with parameter:
.df <- 2 # Degree of freedom .df
.col <- 1; .add <- FALSE # Plot parameters
.x <- seq(0, qchisq(0.999, df = .df), l = 1000)  # Quantiles
.d <- function (x) dchisq(x, df = .df)           # Distribution function
.q <- function (p) qchisq(p, df = .df)           # Quantile for lower-tail prob
.label <- bquote(paste(chi^2,(.(.df))))          # Curve parameters
curve(.d(x), xlim = range(.x), xaxs = "i", n = 1000, col = .col,
  add = .add, xlab = "Quantiles", ylab = "Probability density") # Curve
abline(h = 0, col = "gray") # Baseline
text(.df, .d(.df), .label, pos = 4, col = .col) # Label at right
```

D√©terminez la probabilit√© qu'un quantile soit sup√©rieur ou √©gal √† $\chi^2_{obs}$ = 7.601.

<!-- üí¨ **Ce code correspond au snippet `.icproba`.** -->

```{r chi3_h2, exercise=TRUE}
pchisq(___, df = ___, lower.tail = ___)
```

```{r chi3_h2-hint-1}
pchisq(___, df = 2, lower.tail = FALSE)
```

```{r chi3_h2-solution}
## Solution ##
pchisq(7.601, df = 2, lower.tail = FALSE)
```

```{r chi3_h2-check}
grade_code("Cette probabilit√© est appel√©e valeur p du test d'hypoth√®se.")
```

Pour tirer une conclusion avec le **test d'hypoth√®se** du $\chi^2$ univari√©, vous comparez la valeur *p* ainsi obtenue au seuil $\alpha$ que vous avez fix√© pr√©alablement (choix r√©alis√© *avant* de faire le test pour ne pas √™tre influenc√© par le r√©sultat). Souvent, on prend $\alpha$ = 5% en biologie. Les hypoth√®se (H~0~ = hypoth√®se nulle et H~1~ ou H~A~ = hypoth√®se alternative) du test $\chi^2$ univari√© sont¬†:

-   H~0~ : $a_i = \alpha_i$ pour tout $i$
-   H~1~ : $a_i \neq \alpha_i$ pour au moins un $i$

Les r√®gles pour d√©cider si nous rejetons ou non H~0~ sont¬†:

-   Valeur *p* \< $\alpha$ =\> rejet de H~0~
-   Valeur *p* ‚â• $\alpha$ =\> non rejet de H~0~

Sur base de tout ceci, tirez des conclusions concernant l'exp√©rience de pr√©f√©rence alimentaire chez le chimpanz√©.

```{r qu_conclusion}
question("Que d√©cidez-vous au seuil alpha de 5% ?",
  answer(sprintf("Rejet de $H_{0}$"), correct = TRUE),
  answer(sprintf("Non rejet de $H_{0}$")),
  allow_retry = TRUE, random_answer_order = TRUE,
  incorrect = "Recommencez afin de trouver la bonne r√©ponse",
  correct = "C'est correct ! Nous rejetons H0. Le chimpanz√© pr√©f√®re donc certains fruits (banane) √† d'autres (orange). Les pr√©f√©rences sont d√©duites de la comparaison des fr√©quences observ√©es par rapport aux fr√©quences th√©oriques sous H~0~")
```

### Test $\chi^2$ avec `chisq.test()`

Pour r√©aliser votre test $\chi^2$, vous ne devez heureusement pas passer par tous ces calculs √† la main. En effet, R mets √† votre disposition une fonction qui le fait pour vous¬†: `chisq.test()`. Utilisez maintenant cette fonction pour faire le m√™me calcul sur l'exp√©rience de pr√©f√©rence alimentaire des chimpanz√©s.

<!-- üí¨ **Ce code correspond (pour la derni√®re ligne) au snippet `.hcchi2uni`** [`.hc` = `h`ypothesis tests: `c`ontingency]. -->

```{r chi_test_h3, exercise=TRUE}
# Cr√©ation du jeu de donn√©es
chimp <- dtx(Pomme = 16, Banane = 22, Orange = 7)
# Test Chi^2 univari√©
chisq.test(___, p = ___, rescale.p = ___)
```

```{r chi_test_h3-hint-1}
# Cr√©ation du jeu de donn√©es
chimp <- dtx(Pomme = 16, Banane = 22, Orange = 7)
# Test Chi^2 univari√©
chisq.test(___, p = c(Pomme = ___, Banane = ___, Orange = ___), rescale.p = FALSE)
```

```{r chi_test_h3-hint-2}
# Cr√©ation du jeu de donn√©es
chimp <- dtx(Pomme = 16, Banane = 22, Orange = 7)
# Test Chi^2 univari√©
chisq.test(___, p = c(Pomme = 1/3, Banane = ___, Orange = ___), rescale.p = FALSE)

 #### ATTENTION: Hint suivant = solution !####
```

```{r chi_test_h3-solution}
## Solution ##
# Cr√©ation du jeu de donn√©es
chimp <- dtx(Pomme = 16, Banane = 22, Orange = 7)
# Test Chi^2 univari√©
chisq.test(chimp, p = c(Pomme = 1/3, Banane = 1/3, Orange = 1/3), rescale.p = FALSE)
```

```{r chi_test_h3-check}
grade_code("La fonction `chisq.test()` utilise les probabilit√©s th√©oriques fournies dans `p =` avec `rescale.p = FALSE`, ou les fr√©quences th√©oriques dans `p =`, mais alors il faut indiquer `rescale.p = TRUE`. V√©rifiez que ceci donne le m√™me r√©sultat que votre calcul √† la main.")
```

### Effet de *n*

Calculez √† nouveau un test de $\chi^2$ univari√©, mais cette fois-ci avec dix fois plus de chimpanz√©s, et les m√™mes proportions observ√©es.

```{r}
chimp2 <- dtx(Pomme = 160, Banane = 220, Orange = 70)
knitr::kable(chimp2)
```

```{r chi_test2_h3, exercise=TRUE}
# Cr√©ation du jeu de donn√©es
chimp2 <- dtx(Pomme = 160, Banane = 220, Orange = 70)
# Test Chi^2 univari√©
chisq.test(___, p = ___, rescale.p = FALSE)
```

```{r chi_test2_h3-hint-1}
# Cr√©ation du jeu de donn√©es
chimp2 <- dtx(Pomme = 160, Banane = 220, Orange = 70)
# Test Chi^2 univari√©
chisq.test(___, p = c(Pomme = ___, Banane = ___, Orange = ___), rescale.p = FALSE)
```

```{r chi_test2_h3-hint-2}
# Cr√©ation du jeu de donn√©es
chimp2 <- dtx(Pomme = 160, Banane = 220, Orange = 70)
# Test Chi^2 univari√©
chisq.test(___, p = c(Pomme = 1/3, Banane = ___, Orange = ___), rescale.p = FALSE)

 #### ATTENTION: Hint suivant = solution !####
```

```{r chi_test2_h3-solution}
## Solution ##
# Cr√©ation du jeu de donn√©es
chimp2 <- dtx(Pomme = 160, Banane = 220, Orange = 70)
# Test Chi^2 univari√©
chisq.test(chimp2, p = c(Pomme = 1/3, Banane = 1/3, Orange = 1/3), rescale.p = FALSE)
```

```{r chi_test2_h3-check}
grade_code("Le valeur du chi^2^ obs est beaucoup plus grande ici et la valeur p est plus petite.")
```

Plus l'√©chantillon a une taille *n* importante, plus nous avons des donn√©es √† disposition et nous pourrons donc rejeter H~0~ si elle est fausse *m√™me si l'√©cart entre les* $a_i$ et les $\alpha_i$ est tr√®s petit. Par contre, si cet √©cart est tr√®s grand, un petit nombre d'observations suffira pour rejeter H~0~. A cause de cet effet de *n*, nous ne dirons *jamais* que nous **acceptons** H~1~, mais nous dirons que nous **ne rejetons pas H~0~**. Car, dans cette situation, deux cas sont possibles¬†:

1.  H~0~ est effectivement vraie
2.  H~0~ est fausse, mais l'√©cart est faible et *n* est trop petit pour le d√©tecter, ou nous n'avons pas pu le d√©tecter par le hasard de l'√©chantillonnage

A l'inverse, lorsque l'on travaille avec une taille d'√©chantillon *n* extr√™mement grande, on peut √™tre amen√© √† rejeter H~0~ pour des √©carts entre $a_i$ et $\alpha_i$ tellement faibles qu'ils ne signifient plus rien, biologiquement parlant. **C'est pour cette raison qu'il faut toujours comparer les fr√©quences observ√©es et les fr√©quences th√©oriques en cas de rejet de H~0~**, afin de se faire une id√©e de l'amplitude des √©carts et des niveaux qu'ils concernent.

## Conclusion

Ayant maintenant compris la logique et l'utilisation de la distribution du $\chi^2$ et son test d'hypoth√®se univari√©, nous aborderons dans le prochain learnr une autre variante¬†: le test $\chi^2$ d'ind√©pendance.

```{r comm_noscore, echo=FALSE}
question_text(
  "Laissez-nous vos impressions sur ce learnr",
  answer("", TRUE, message = "Pas de commentaires... C'est bien aussi."),
  incorrect = "Vos commentaires sont enregistr√©s.",
  placeholder = "Entrez vos commentaires ici...",
  allow_retry = TRUE
)
```
