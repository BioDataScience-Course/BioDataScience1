---
title: "Corr√©lation"
author: "Guyliann Engels & Philippe Grosjean"
description: "**SDD I Module 12** Le coefficient de corr√©lation et le test de corr√©lation."
output:
  learnr::tutorial
tutorial:
  id: "A12La_correlation"
  version: 2.0.0/5
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
BioDataScience1::learnr_setup()
SciViews::R()
```

```{r, echo=FALSE}
BioDataScience1::learnr_banner()
```

```{r, context="server"}
BioDataScience1::learnr_server(input, output, session)
```

----

## Objectifs

L'association entre deux variables peut √™tre quantifi√©e gr√¢ce √† diff√©rentes descripteurs ou indices comme la covariance, l'indice de de corr√©lation de Pearson ou encore l'indice de de corr√©lation de Spearman. On d√©finit 3 niveaux d'association impliquant des hypoth√®ses de plus en plus fortes sur le m√©canismes sou-jacent liant ces deux variables. On a la corr√©lation, la relation et la causalit√©. Les indices de corr√©lation et les tests de corr√©lation permettent comme leur nom l'indique de mettre un avant une corr√©lation entre deux variables. La corr√©lation est simplement l‚Äôassociation de deux variable sans √©laborer plus d‚Äôexplication sur le m√©canisme sous-jacent qui lie ces variables.

Dans ce tutoriel, vous allez pouvoir auto-√©valuer votre capacit√© √†\ :

- Comprendre les diff√©rents niveaux d‚Äôassociation de deux variables num√©riques.

- R√©aliser et interpr√©ter un test de corr√©lation

## Biom√©trie de trois esp√®ces d'Iris

L'√©tude porte sur les variations morphologiques des fleurs de trois esp√®ces d'iris que sont *Iris setosa* Pall. ex Link (1820) , *Iris versicolor* L. (1753) et *Iris virginica* L.. Ces esp√®ces appartiennent √† la famille des Iridaceae. Ces trois esp√®ces se d√©veloppent dans des milieux humides. 

Edgar Anderson a r√©colt√© les trois esp√®ces d'iris en Gasp√©sie (Qu√©bec, Canada) en 1935 au moment de la floraison. La p√©ninsule de Gasp√©sie est entour√©e par l'estuaire du fleuve Saint-Laurent, le golfe du Saint-Laurent et la baie des chaleurs.

Cinquante plants par esp√®ce sont pr√©lev√©s afin d'√©tudier la biom√©trie de leurs fleurs. La longueur et la largeur des p√©tales et s√©pales sont mesur√©es (en centim√®tre).

![](images/iris.jpg)   

Vous avez √† votre disposition un jeu de donn√©es sur des mesures biom√©triques d'iris.

```{r, echo = TRUE}
# Importation des donn√©es
(iris <- read("iris", package = "datasets", lang = "fr"))
```


La fonction `skim()` du package `skimr` est une fonction tr√®s int√©ressante dans un carnet de notes pour d√©couvrir les donn√©es. Avec une seule fonction, on obtient une premi√®re id√©e sur le nombre d'observations, le type des variables, la pr√©sence de valeurs manquantes,...

```{r, echo=TRUE}
skimr::skim(iris)
```

Le jeu de donn√©es iris est parfaitement balanc√© avec 50 individus par groupe. Il comprends 4 variables num√©riques et 1 variable facteur non-ordonn√©e. Il ne comprend pas de valeurs manquantes.

```{r iris_prepa}
iris <- read("iris", package = "datasets", lang = "FR")
```

Avant de poursuivre votre exploration des donn√©es, r√©alisez diff√©rents graphiques en fonction des diff√©rents variables. 

```{r scatterplot_noscore, exercise=TRUE, exercise.setup = "iris_prepa"}
chart(data = iris, ___ ~ ___ %col=% species) +
  geom_point()
```

## Matrice de corr√©lation 

R√©alisez une matrice de corr√©lation afin de mettre en avant la corr√©lation lin√©aire entre l'ensemble des variables num√©rique disponibles. Proposez ensuite un r√©sum√© de cette matrice.

üí¨ **Un snippet est disponible pour r√©aliser cet exercice `.escor: correlation matrix`.**

```{r is_corr_h2, exercise=TRUE, exercise.lines=1, exercise.setup="iris_prepa"}
iris_corr <- correlation(___[, ___:___], use = "complete.obs", method = "___")
summary(iris_corr)
```

```{r is_corr_h2-hint-1}
iris_corr <- correlation(DF[, INDEX_EXPRESSION], use = "complete.obs", method = "pearson")
summary(iris_corr)
# La s√©lection se fait sur base des indices des colonnes en R de base. 
# Vous ne devez s√©lectionner que les variables num√©riques.

 #### ATTENTION: Hint suivant = solution !####
```

```{r is_corr_h2-solution}
iris_corr <- correlation(iris[, 1:4], use = "complete.obs", method = "pearson")
summary(iris_corr)
```

```{r is_corr_h2-check}
grade_code("Le r√©sume de la matrice de corr√©lation utilise un syst√®me de l√©gende particulier pour mettre en avant les variables les plus corr√©l√©es. Assurez-vous de bien comprendre les symboles utilis√©s ., + ou encore B.")
```

R√©alisez un graphique de votre objet `iris_corr`. N'affichez que la partie sup√©rieur de votre matrice. Tout comme le r√©sum√© de la matrice ne montre que la partie inf√©rieure de la matrice, il n'est pas utile de repr√©senter la matrice compl√®te sous forme graphique. La matrice est sym√©trique.

```{r iris_corr}
iris <- read("iris", package = "datasets", lang = "FR")
iris_corr <- correlation(iris[, 1:4], use = "complete.obs", method = "pearson")
```

```{r is_plot_h2, exercise=TRUE, exercise.lines=1, exercise.setup="iris_corr"}
___(iris_corr, type = "___")
```
 
```{r is_plot_h2-hint-1}
plot(iris_corr, type = "___")

#### ATTENTION: Hint suivant = solution !####
```
 
```{r is_plot_h2-solution}
plot(iris_corr, type = "upper")
```

```{r is_plot_h2-check}
grade_code("Ce graphique permet d'avoir une information visuelle simple √† analyser. La couleur utilis√©e, l'√©longation de l'√©llipse et le sens de l'ellipse sont porteur d'information sur la corr√©lation entre les paires de variabls √©tudi√©es. R√©pondez √† la question suivante.")
```

```{r quiz_corr}
question("Quelles sont les variables les plus fortement corr√©l√©es ?(s√©lectionnez les deux variables les plus corr√©l√©es)",
         answer("sepal_length"),
         answer("sepal_width"),
         answer("petal_length", correct = TRUE),
         answer("petal_width", correct = TRUE),
           allow_retry = TRUE,
           incorrect = "Recommencez afin de trouver la bonne r√©ponse",
           correct = "Bravo, c'est correct. Vous avez su d√©coder avec succ√®s votre matrice de corr√©lation")
```

## Test de corr√©lation 

Suite √† votre matrice de corr√©lation lin√©aire avec l'indice de corr√©lation de Pearson, vous avez pu observer que la longueur des p√©tales et la largeur des p√©tales ont un indice de corr√©lation sup√©rieur √† 0.9. Cependant, avoir une valeur √©lev√© ne permet pas d'affirmer qu'il y une corr√©lation significative entre ces deux variables. 

Utilisez un test de corr√©lation afin de r√©pondre √† la question suivante : **est ce que la largeur des p√©tales (petal_width) et la longueur des p√©tales (petal_length) sont significativement corr√©l√©es au seuil alpha de 5% ? **

```{r cortest_h2, exercise=TRUE, exercise.lines=3, exercise.setup="iris_prepa"}
cor.test(data = ___, ~ ___ + ___,
  alternative = "two.sided", method = "___")
```

```{r cortest_h2-hint-1}
cor.test(data = iris, ~ ___ + ___, 
  alternative = "two.sided", method = "___")

#### ATTENTION: Hint suivant = solution !####
```

```{r cortest_h2-solution}
cor.test(data = iris, ~ petal_width + petal_length, 
  alternative = "two.sided", method = "pearson")
```

```{r cortest_h2-check}
grade_code("Bravo ! Vous venez de r√©aliser un test de corr√©lation de Pearson. Il ne vous reste plus qu'√† r√©pondre √† la question ci-dessous. Pour vous assurer que vous √™tes capable de d'interpr√©ter ce test d'hypoth√®se.")
```

```{r quiz_test}
question("Est ce que la largeur des p√©tales (petal_width) et la longueur des p√©tales (petal_length) sont significativement corr√©l√©es au seuil alpha de 5% ?",
  answer("Oui", correct = TRUE),
  answer("Non"),
  correct = "Bravo, c'est exact ! Avec une valeur inf√©rieur au seuil alpha, il y a rejet de l'hypoth√®se nulle.", 
  incorrect = "Il semble que vous n'avez pas su d√©terminer correctement l'hypoth√®se nulle et l'hypoth√®se alternative.", 
  allow_retry = TRUE)
```

## Conclusion

Bravo! Vous venez de terminer le tutoriel sur la premier niveau d'association de paires de variables qu'est la corr√©lation.

```{r comm_noscore, echo=FALSE}
question_text(
  "Laissez-nous vos impressions sur cet outil p√©dagogique",
  answer("", TRUE, message = "Pas de commentaires... C'est bien aussi."),
  incorrect = "Vos commentaires sont enregistr√©s.",
  placeholder = "Entrez vos commentaires ici...",
  allow_retry = TRUE
)
```
