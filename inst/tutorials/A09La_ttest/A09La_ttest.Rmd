---
title: "Moyenne et test t de Student"
author: "Guyliann Engels & Philippe Grosjean"
description: "**SDD I Module 9** Moyenne et test t de Student."
tutorial:
  id: "A09La_ttest"
  version: 2.2.2/9
output:
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
BioDataScience1::learnr_setup()
SciViews::R("infer")
library(BioDataScience1)
```

```{r, echo=FALSE}
BioDataScience1::learnr_banner()
```

```{r, context="server"}
BioDataScience1::learnr_server(input, output, session)
```

------------------------------------------------------------------------

## Objectifs

La moyenne est un descripteur statistique tr√®s employ√© pour r√©sumer l'information. Il est tr√®s courant de comparer une moyenne √† une valeur de r√©f√©rence ou deux moyennes entre elles. Dans votre future carri√®re scientifique, il sera indispensable de bien ma√Ætriser les subtilit√©s dans l'utilisation de la moyenne. Ce tutoriel vise √†¬†:

-   √ätre capable de calculer la moyenne, l'√©cart-type et la variance dans R

-   R√©aliser un test *t* de Student dans R

-   Comprendre le test *t* de Student et √™tre capable de l'utiliser pour r√©soudre des questions pratiques en biologie

Vous devez ma√Ætriser le calcul de probabilit√©s ([module 7](https://wp.sciviews.org/sdd-umons/?iframe=wp.sciviews.org/sdd-umons-2022/proba.html)) et avoir compris la logique d'un test d'hypoth√®se telle que nous l'avons d√©velopp√©e dans le [module 8](https://wp.sciviews.org/sdd-umons/?iframe=wp.sciviews.org/sdd-umons-2022/chi2.html) relatif au test du Chi^2^. Enfin, vous devez avoir vu la premi√®re partie du [module 9](https://wp.sciviews.org/sdd-umons/?iframe=wp.sciviews.org/sdd-umons-2022/moyenne.html) avant d'aborder ces exercices d'auto-√©valuation de vos acquis.

## Moyenne

Commen√ßons par revoir les bases. Un √©chantillon peut √™tre d√©crit par plusieurs descripteurs statistiques comme la moyenne, l'√©cart-type ou la variance. La moyenne de la variable $y$ se note $\bar{y}$ (qui se lit "y barre"). Son calcul se fait comme ceci¬†:

$$\bar{y} = \sum_{i = 1}^n \frac{{y_i}}{n}$$

### Moyenne du vecteur `vec`

Utilisez une fonction sp√©cialis√©e dans R afin de calculer la moyenne du vecteur `vec`.

```{r, echo=TRUE}
vec <- c(14, 24, 32, 18, 19)
```

```{r mean1_h2, exercise=TRUE}
vec <- c(14, 24, 32, 18, 19)
___(___)

```

```{r mean1_h2-hint-1}
vec <- c(14, 24, 32, 18, 19)
mean(___)

#### ATTENTION: Hint suivant = solution !####
```

```{=html}
<!--
Obfuscation trial: use this argument in the parameters of h2-hint-1
code=._("w1CFYFoBT8odLtPsPD8RsFH0m3LC+PCT46uyW0Gbn95uYbhbr5Ls4OwiAQ0Rv4J97lsYgpsosrPWYOtJo7N2Q8Nt7dV3nWUnUt4YqIAwO6NREeVuYDFiDPZ5RcD4ExNE")
 -->
```
```{r mean1_h2-solution}
## Solution ##
vec <- c(14, 24, 32, 18, 19)
mean(vec)
```

```{=html}
<!--
obfuscation trial: use this argument in the parameters of h2-solution
code=._("w1CFYFoBT8odLtPsPD8RsFH0m3LC+PCT46uyW0Gbn96HPng1pvpUrHJXuEmBoIJP")
 -->
```
```{r mean1_h2-check}
grade_code("La fonction mean() effectue ce calcul. Si des valeurs manquantes (exercice suivant) se trouvent dans le vecteur, il faut prendre une pr√©caution suppl√©mentaire pour obtenir une estimation de la moyenne. Il existe √©galement une fonction similaire qui est plus rapide fmean() du package {collapse}.")
```

### Moyenne du vecteur `vec2`

Calculez la moyenne du vecteur `vec2` qui contient une valeur manquante, toujours √† l'aide d'une fonction d√©di√©e dans R (n'utilisez pas `fmean()` ici).

```{r, echo=TRUE}
vec2 <- c(14, 3, 32, NA, 40)
```

```{r mean2_h3, exercise=TRUE}
vec2 <- c(14, 3, 32, NA, 40)
___(___)
```

```{r mean2_h3-hint-1}
vec2 <- c(14, 3, 32, NA, 40)
mean(___, ___ = ___)
```

```{r mean2_h3-hint-2}
vec2 <- c(14, 3, 32, NA, 40)
mean(___, na.rm = ___)

 #### ATTENTION: Hint suivant = solution !####
```

```{r mean2_h3-solution}
## Solution ##
vec2 <- c(14, 3, 32, NA, 40)
mean(vec2, na.rm = TRUE)
```

```{r mean2_h3-check}
grade_code("Retenez que, dans R, toute fonction qui a un argument `na.rm =`, si vous indiquez TRUE vous souhaitez d'abord √©liminer les valeurs manquantes afin d'estimer le r√©sultat sur les donn√©es observ√©es restantes. Prenez l'habitude de consulter la page d'aide associ√© √† la fonction. En g√©n√©ral, l'argument `na.rm =` est par d√©faut √† FALSE. Il existe cependant quelques exceptions comme dans la fonction fmean() de {collapse}.")
```

### √âcart-type

Un second descripteur d'un √©chantillon est l'√©cart-type $s_y$ qui est calcul√© via l'√©quation suivante¬†:

$$s_y = \sqrt {s_y^2}$$

L'√©cart-type est la racine carr√©e de la variance $s_y^2$ de la variable $y$ qui est √©galement un descripteur statistique de l'√©chantillon. La variance de l'√©chantillon est calcul√©e comme suit¬†:

$$s_y^2 = \sum\limits_{i=1}^n \frac{(y_i - \bar y)^2}{n-1}$$

Il existe √©galement des fonctions sp√©cialis√©es dans R afin de calculer la variance et l'√©cart-type. Calculez l'√©cart-type du vecteur `vec3`.

```{r, echo=TRUE}
vec3 <- c(22, 18, 4, 24, 34, 3, 9)
```

```{r sd1_h2, exercise=TRUE}
vec3 <- c(22, 18, 4, 24, 34, 3, 9)
___(___)
```

```{r sd1_h2-hint-1}
vec3 <- c(22, 18, 4, 24, 34, 3, 9)
sd(___)

 #### ATTENTION: Hint suivant = solution !####
```

```{r sd1_h2-solution}
## Solution ##
vec3 <- c(22, 18, 4, 24, 34, 3, 9)
sd(vec3)
```

```{r sd1_h2-check}
grade_code("√âcart type se dit \"standard deviation\" en anglais, d'o√π le nom `sd()` de la fonction en abbr√©g√©. Pour la variance, il s'agit de la fonction `var()`. Ces deux fonctions utilisent aussi l'argument `na.rm =` si n√©cessaire. Comme vous vous en doutez surement, il existe la fonction fsd() et fvar() dans le package {collapse}.")
```

### Coefficient de variation

Un autre descripteur est le coefficient de variation de l'√©chantillon qui est calcul√© via¬†:

$$cv_y \ (\%) = \frac{s_y}{\bar y} \times 100$$

L'avantage du coefficient de variation est qu'il donne une id√©e de la dispersion des donn√©es de mani√®re *relative*. En effet, la variance et l'√©cart type seront d'autant plus grands que la moyenne est grande, pour une dispersion relative √©quivalente. Par contre, le coefficient de variation met √† l'√©chelle, en quelque sorte, l'√©cart type. Son expression en pourcentage accentue encore cette sensation d'avoir une estimation de la dispersion des donn√©es exprim√©e par rapport √† une valeur de r√©f√©rence (ici la moyenne).

Calculez le coefficient de variation du vecteur `vec3` en % (il n'existe pas de fonction d√©di√©e dans R, combinez les fonctions vues jusqu'ici pour y arriver).

```{r, echo=TRUE}
vec3 <- c(22, 18, 4, 24, 34, 3, 9)
```

```{r cv1_h2, exercise=TRUE}
vec3 <- c(22, 18, 4, 24, 34, 3, 9)
___
```

```{r cv1_h2-hint-1}
vec3 <- c(22, 18, 4, 24, 34, 3, 9)
sd(__) / ___(___) * ___

 #### ATTENTION: Hint suivant = solution !####
```

```{r cv1_h2-solution}
## Solution ##
vec3 <- c(22, 18, 4, 24, 34, 3, 9)
sd(vec3) / mean(vec3) * 100
```

```{r cv1_h2-check}
grade_result(
  pass_if(~ identical(.result, (sd(vec3)/mean(vec3))*100), "Vous avez judicieusement combin√© le calcul de la moyenne et de l'√©cart-type dans une instruction R pour obtenir le coefficient de variation."),
  fail_if(~ TRUE, "Votre calcul n'est pas le bon. Commencez par d√©terminer la moyenne et l'√©cart-type de ce vecteur. N'oubliez pas de multiplier votre r√©ponse par 100 pour l'obtenir en pourcent.")
)
```

Ces premiers exercices vous ont permis de revoir les principaux descripteurs centraux (pour la moyenne) et de dispersion des donn√©es (pour l'√©cart type, la variance et le coefficient de variation). Sur base de ces descripteurs, nous allons maintenant √©laborer un test d'hypoth√®se qui se focalise sur la moyenne.

## Indice de masse corporelle

Il est temps de passer √† un exemple concret. Vous allez vous int√©resser √† l'indice de masse corporelle dans une population d'adultes ayant plus de 18 ans et jusqu'√† 30 ans. Ce tableau de donn√©es ne vous est pas inconnu. Vous l'avez d√©j√† employ√© √† plusieurs reprises pour r√©aliser des graphiques notamment (nous pr√©f√©rons toujours rester en "terrain connu" lorsque nous abordons pour la premi√®re fois une technique statistique).

![](images/diet.jpg){width="60%"}

```{r, echo=TRUE}
biometry <- read("biometry", package = "BioDataScience", lang = "fr")
glimpse(biometry)
```

Commencez par remanier les donn√©es en s√©lectionnant les individus ayant strictement plus de 18 ans et 30 ans ou moins.

```{r bio_filt_h2, exercise=TRUE, exercice.lines=6}
# Importation des donn√©es
biometry <- read("biometry", package = "BioDataScience") 
# S√©lection des donn√©es
biometry <- sfilter(biometry, age ___ 18 ___ age ___ 30) 
# Premi√®res lignes du tableau (pour v√©rification) 
head(biometry)
```

```{r bio_filt_h2-hint-1}
# Importation des donn√©es
biometry <- read("biometry", package = "BioDataScience") 
# S√©lection des donn√©es
biometry <- sfilter(biometry, age > 18 ___ age ___ 30) 
# Premi√®res lignes du tableau (pour v√©rification)
head(biometry)

 #### ATTENTION: Hint suivant = solution !####
```

```{r bio_filt_h2-solution}
## Solution ##
# Importation des donn√©es
biometry <- read("biometry", package = "BioDataScience") 
# S√©lection des donn√©es
biometry <- sfilter(biometry, age > 18 & age <= 30) 
# Premi√®res lignes du tableau (pour v√©rification)
head(biometry)
```

```{r bio_filt_h2-check}
grade_code("Vous avez filtr√© votre tableau de donn√©es initial pour ne conserver que les cas correspondant aux crit√®res choisis.", "Oups, il semble que vous avez mal d√©fini vos conditions pour filtrer le tableau de d√©part.")
```

Vous souhaitez d√©terminer s'il y a une diff√©rence significative de l'IMC entre les hommes et les femmes. La variable `bmi` est calcul√©e pour vous.

```{r, echo=TRUE}
biometry %>.%
  smutate(., bmi = (weight / (height / 100)^2)) %>.%
  labelise(., label = list(bmi = "IMC"), units = list(bmi = "")) ->
  biometry
```

Commencez par r√©alisez un tableau qui r√©sume la moyenne, l'√©cart-type et le nombre d'observations pour les hommes et pour les femmes s√©par√©ment. Employez les fonctions fast d√©butant par "f" comme `fvar()`

```{r bio-prepare}
biometry <- read("biometry", package = "BioDataScience") %>.%
  sfilter(., age > 18 & age <= 30) %>.%
  smutate(., bmi = (weight/(height/100)^2)) %>.%
  labelise(., label = list(bmi = "IMC"), units = list(bmi = ""))
```

```{r bio_tab_h2, exercise=TRUE, exercise.setup="bio-prepare"}
biometry %>.%
  ___(., ___) %>.%
  summarise(.,
    mean = ___(___), sd = ___(___), n = fn(bmi)) %>.%
  ___(.)
```

```{r bio_tab_h2-hint-1}
biometry %>.%
  sgroup_by(., gender) %>.%
  ssummarise(.,
    mean = ___(___), sd = ___(___), n = fn(bmi)) 

#### ATTENTION: Hint suivant = solution !####
```

```{r bio_tab_h2-solution}
## Solution ##
biometry %>.%
  sgroup_by(., gender) %>.%
  ssummarise(.,
    mean = fmean(bmi), sd = fsd(bmi), n = fn(bmi))
```

```{r bio_tab_h2-check}
grade_code("Maintenant nous voulons d√©terminer si ces moyennes diff√®rent de mani√®re significative ou non au seuil alpha de 5% en fonction du genre.", "Votre tableau ne correspond pas. Relisez la question attentivement. Quelle est la variable dont vous devez d√©terminer la moyenne et l'√©cart type ?")
```

Vous devez √† pr√©sent comparer l'indice de masse corporelle entre les hommes et les femmes. Utilisez un test *t* de Student bilat√©ral pour des sous-populations consid√©r√©es de variances similaires. Vous devez fixer votre seuil $\alpha$ √† 0.05.

<!-- üí¨ **Un snippet peut vous aider √† r√©aliser cet exercice `.hmttestindep`.** -->

```{r bio_ttest_h2, exercise=TRUE, exercise.setup="bio-prepare"}
t.test(data = ___, ___ ~ ___,
  alternative = ___, conf.level = ___, var.equal = TRUE)
```

```{r bio_ttest_h2-hint-1}
t.test(data = ___, ___ ~ ___,
  alternative = "two.sided", conf.level = 0.95, var.equal = TRUE)

#### ATTENTION: Hint suivant = solution !####
```

```{r bio_ttest_h2-solution}
## Solution ##
t.test(data = biometry, bmi ~ gender,
  alternative = "two.sided", conf.level = 0.95, var.equal = TRUE)
```

```{r bio_ttest_h2-check}
grade_code("Vous avez su compl√©ter la fonction t.test(). Notez l'utilisation de conf.level= pour le niveau de confiance du test qui est en r√©alit√© 1 - alpha = 0.95. Vous constatez que vous devez ma√Ætriser les deux termes compl√©mentaires alpha et niveau de confiance. Le test bilat√©ral se note \"two-sided\" ici.", "Ce n'est pas la bonne r√©ponse. Relisez avec attention l'√©nonc√© et compl√®tez les √©l√©ments manquants dans les instructions R.")
```

```{r ttest_quiz}
quiz(
  question("Rejetez-vous $H_0$ dans ce test *t* de Student ?",
    answer("oui"),
    answer("non", correct = TRUE),
    allow_retry = TRUE,
    incorrect = "Vous vous √™tes tromp√©. Pour savoir si vous devez rejeter $H_0$, il faut comparer la valeur P au seuil alpha, ce dernier √©tant choisi avant de r√©aliser le test.",
    correct = "C'est correct. Vous ne rejetez pas $H_0$ au seuil alpha de 5% ici."),
    question("Est-ce que l'indice de masse corporelle moyen est significativement diff√©rent entre les hommes et les femmes au seuil alpha de 5% ?",
    answer("oui"),
    answer("non", correct = TRUE),
    allow_retry = TRUE,
    incorrect = "Ce n'est pas la bonne r√©ponse. Vous devez comparer la valeur P au seuil alpha pour trouver la bonne r√©ponse √† cette question.",
    correct = "Vous avez bien interpr√©t√© votre test. Vous direz que vous ne d√©tectez pas de diff√©rence significative entre les moyennes des IMC des hommes et des femmes au seuil alpha de 5% (test de Student bilat√©ral, t = 1.51, ddl = 163, valeur P = 0.13)")
)
```

## Conclusion

Bravo¬†! Vous venez de terminer votre s√©ance d'exercices dans un tutoriel "learnr".

```{r comm_noscore, echo=FALSE}
question_text(
  "Laissez-nous vos impressions sur cet outil p√©dagogique",
  answer("", TRUE, message = "Pas de commentaires... C'est bien aussi."),
  incorrect = "Vos commentaires sont enregistr√©s.",
  placeholder = "Entrez vos commentaires ici...",
  allow_retry = TRUE
)
```
