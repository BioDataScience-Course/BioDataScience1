---
title: "Student & Wilcoxon"
author: "Guyliann Engels & Philippe Grosjean"
description: "**SDD I Module 9** Les tests de Student et de Wilcoxon/Mann-Withney."
tutorial:
  id: "A09b_ttest_wmw"
  version: 2.0.0/11
output:
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
BioDataScience1::learnr_setup()
SciViews::R()
```

```{r, echo=FALSE}
BioDataScience1::learnr_banner()
```

```{r, context="server"}
BioDataScience1::learnr_server(input, output, session)
```

----

## Objectifs

Le test t de Student (ou plut√¥t les tests de Student puisqu‚Äôil en existe plusieurs variantes) utilise la distribution t de Student comme distribution de r√©f√©rence pour comparer une moyenne par rapport √† une valeur cible ou pour comparer deux moyennes. 

- Comprendre les diff√©rentes variantes du test *t* de Student et √™tre capable de l'utiliser pour r√©soudre des questions pratiques en biologie

- Conna√Ætre √©galement le test de Wilcoxon-Mann-Withney, et pouvoir d√©terminer quand l‚Äôutiliser √† la place du test de Student

## Efficacit√© du mCPP

![Image par <a href="https://pixabay.com/fr/users/geralt-9301/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=162952">Gerd Altmann</a> de <a href="https://pixabay.com/fr/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=162952">Pixabay</a>](images/weight.jpg){width=50%}

Vous avez √† votre disposition un jeu de donn√©es dont la th√©matique est la perte de poids. Des chercheurs se sont int√©ress√©s √† l‚Äôeffet du mCPP sur l‚Äôapp√©tit de 2 groupes de patients ob√®ses. Un groupe va recevoir le comprim√© contenant le mCPP et le second un comprim√© plac√©bo. Chaque patient est pes√© au d√©but et √† la fin de l‚Äôexp√©rience pour d√©terminer la variation de poids. Aidez les chercheurs a d√©terminer si le mCPP a un effet sur la perte de poids.

```{r, echo = TRUE}
weight <- c(0.00, -1.10, -1.60, -0.30, -1.10, -0.90, -0.50, 0.70, -1.20,
           -1.10, 0.50, 0.50, 0.00, -0.50, 1.30, -1.40, 0.00, -0.80,
           -1.10, -1.30, -1.00, -1.70, -1.40, - 0.10, - 0.50, -1.60, 0.50,
           0.00, 0.30, -0.60, -0.30, 0.70, 0.20, -0.60, -0.90, 2.00)
mcpp <- tibble(weight = weight, gender = rep(c("M","F"), each = 18), treatment = rep(c("mcpp","placebo", "mcpp", "placebo"), each = 9), )

mcpp$gender <- factor(mcpp$gender, levels = c("M", "F"))
mcpp$treatment <- factor(mcpp$treatment, levels = c("placebo", "mcpp"))

mcpp
```

```{r prepare_mcpp}
weight <- c(0.00, -1.10, -1.60, -0.30, -1.10, -0.90, -0.50, 0.70, -1.20,
           -1.10, 0.50, 0.50, 0.00, -0.50, 1.30, -1.40, 0.00, -0.80,
           -1.10, -1.30, -1.00, -1.70, -1.40, - 0.10, - 0.50, -1.60, 0.50,
           0.00, 0.30, -0.60, -0.30, 0.70, 0.20, -0.60, -0.90, 2.00)
mcpp <- tibble(weight = weight, gender = rep(c("M","F"), each = 18), treatment = rep(c("mcpp","placebo", "mcpp", "placebo"), each = 9), )

mcpp$gender <- factor(mcpp$gender, levels = c("M", "F"))
mcpp$treatment <- factor(mcpp$treatment, levels = c("placebo", "mcpp"))
```

Le jeu de donn√©es mcpp comprend 3 variables dont la variable facteur `treatment` qui comprend 2 niveaux. 

```{r, echo = TRUE}
levels(mcpp$treatment)
```

### Tableau r√©sum√©

R√©alisez un r√©sum√© des donn√©es en fonction du traitement administr√©. Utilisez les √©l√©ments ci-dessous pour compl√©ter les instructions R (les √©l√©ments peuvent √™tre employ√© plusieurs fois).

```{r}
variable <- c("mcpp", "treatment", "weight", "group_by", "summarise", "mean", "sd")
sample(variable)
```

```{r mcpp_tab_h2, exercise = TRUE, exercise.setup = "prepare_mcpp"}
___ %>.%
  ___(., ) %>.%
  ___(., mean = ___(___), sd = ___(___), n = n())
```

```{r mcpp_tab_h2-hint-1}
mcpp %>.% 
  group_by(., ___) %>.%
  summarise(., mean = ___(___), sd = ___(___), n = n())
#### ATTENTION: Hint suivant = solution !####
```

```{r mcpp_tab_h2-solution}
mcpp %>.% 
  group_by(., treatment) %>.%
  summarise(., mean = mean(weight), sd = sd(weight), n = n())
```

```{r mcpp_tab_h2-check}
grade_code("Bien jou√© ! Vous avez r√©alis√© le tableau souhait√© avec les √©l√©ments qui vous sont propos√©s.", "Oups, il semble que vous n'avez pas obtenu le bon r√©sulat. Relisez attentivemetn les √©l√©ments mis √† votre disposition pour compl√©ter les instructions.")
```

### Test de Student

R√©alisez √† pr√©sent un test de Student pour comparer ces deux moyennes. Avant de vous lancer dans l'ex√©cution d'un test, N'oubliez pas de les √©tapes suivantes :

- v√©rifier si le test r√©pond √† votre question de recherche 
- v√©rifier les conditions d'applications du test

Pour rappel, les conditions sont les suivantes :

- √©chantillon repr√©sentatif (√©chantillonnage al√©atoire et individus ind√©pendants les uns des autres),
- observations ind√©pendantes les unes des autres,
- distribution de la population : 
    + normale, alors le test bas√© sur la distribution t de Student sera exact,
    + approximativement normale, le test sera approximativement exact,
    + non normale, le test sera approximativement exact si n est grand.

üí¨ **Le code propos√© ci-dessous correspond au snippet `.hmtestindep`**

```{r, echo = TRUE, eval = FALSE}
t.test(data = DF, YNUM ~ XFACTOR,
  alternative = "two.sided", conf.level = 0.95, var.equal = TRUE)
```

Attardez vous d'abord sur la compr√©hension de chacun des arguments de la fonction.

- data = DF : vous devez sp√©cifier le nom de jeu de donn√©es
- YNUM ~ XFACTOR : vous devez sp√©cifier sous forme de formule les variables que vous souhaitez √©tudier
- alternative = "two.sided" : vous devez sp√©cifier si le test est  
    + un test bilat√©ral : "two.sided"
    + un test unilat√©ral √† droite : "less"
    + un test unilat√©ral √† gauche : "greater"
- conf.level = 0.95 : vous devez sp√©cifier l'intervalle de confiance de votre exp√©rience.
- var.equal = TRUE : Si les variances de vos sous populations sont √©quivalentes, indiquez var.equal = TRUE.

**Lorsque les observations sont peu nombreuses (moins de 30 observations par groupe), il est conseill√© d'employ√© le test de Welch qui est une variante du test de student lorsque la variance est consid√©r√©e comme non homog√®nes (var.equal = FALSE)**

R√©alisez une test de welch unilat√©ral √† gauche avec un seuil $\alpha$ de 5% afin d'aider les scienifiques.

```{r mcpp_ttest_h2, exercise = TRUE, exercise.setup = "prepare_mcpp"}
t.test(data = ___, ___ ~ ___,
  alternative = "___", conf.level = ___, var.equal = ___)
```

```{r mcpp_ttest_h2-hint-1}
t.test(data = mcpp, weight ~ treatment,
  alternative = "___", conf.level = ___, var.equal = ___)
#### ATTENTION: Hint suivant = solution !####
```

```{r mcpp_ttest_h2-solution}
t.test(data = mcpp, weight ~ treatment,
  alternative = "greater", conf.level = 0.95, var.equal = FALSE)
```

```{r mcpp_ttest_h2-check}
grade_code("Bien jou√© ! Vous avez r√©aliser un test de Welch avec les arguments souhait√©s.", "Oups, il semble que vous n'avez pas obtenu le bon r√©sulats. Relisez avec attention la question et identifiez chaque valeur pour chaque argument √† completer.")
```

Analysez le tableau des r√©sultats et r√©pondez aux questions ci-dessous.

```{r quiz}
quiz(
  question("Est ce que le mCPP a un effet sur la perte de poids ?",
           answer("oui", correct = TRUE),
           answer("non"),
           allow_retry = TRUE,
           incorrect = "Ce n'est pas la bonne r√©ponse. Vous devez comparer la valeur de p au seuil $\alpha$  d√©fini avant de r√©aliser le test pour trouver la bonne r√©ponse √† cette question.",
           correct = "Bravo, c'est correct. Vous avez bien interpr√©t√© votre test."),
  question("Rejettez vous $H_0$ ?",
           answer("oui", correct = TRUE),
           answer("non"),
           allow_retry = TRUE,
           incorrect = "Vous vous √™tes tromp√©. Pour savoir si vous devez rejeter $H_0$, il faut comparer la valeur de p au seuil $\alpha$  d√©fini avant de r√©aliser le test.",
           correct = "Bravo, c'est correct. Vous ne rejettez pas le $H_0$ au seuil $\alpha$ de 0.05")
)
```


## Dopamine

![Image par <a href="https://pixabay.com/fr/users/geralt-9301/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2481808">Gerd Altmann</a> de <a href="https://pixabay.com/fr/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2481808">Pixabay</a>](images/motivation.jpg){width=50%}

La dopamine est un neurotransmetteur qui a un effet sur la motivation, la curiosit√© (augmentation de la fr√©quence cardiaque,...). Une baisse de la dopamine peut √™tre mise en corr√©lation avec la d√©pression, la phobie sociale,... Un taux anormalement haut de dopamine peut √™tre mis en corr√©lation avec les addictions, la schizophr√©nie,...

Le tolu√®ne est une mol√©cule organique tr√®s employ√©e dans un ensemble de proc√©d√©s chimiques. Ce composant affecte le syst√®me nerveux central. Les chercheurs ont √©tudi√© l‚Äôeffet de ce dernier sur des rats. Ils ont dos√© la dopamine comme indicateur de l‚Äô√©tat de sant√© des rats. 

Le tolu√®ne a t‚Äôil donc un effet sur la concentration en dopamine dans le cerveau ? Sur 12 rats √©tudi√©s, 6 sont expos√©s au tolu√®ne et 6 sont utilis√©s comme contr√¥le.

```{r, echo = TRUE}
dopamine <- tibble(treatment = rep(c("Cont", "Tol"), each = 6), 
                      concentration = c(1.820, 1.843, 1.397, 1.803, 2.539, 
                                        1.990, 3.420, 2.314, 1.911, 2.464, 
                                        2.781, 2.803))
dopamine$treatment<- as.factor(dopamine$treatment)
dopamine
```

```{r prepare_toluene, echo = TRUE}
dopamine <- tibble(treatment = rep(c("Cont", "Tol"), each = 6), 
                      concentration = c(1.820, 1.843, 1.397, 1.803, 2.539, 
                                        1.990, 3.420, 2.314, 1.911, 2.464, 
                                        2.781, 2.803))
dopamine$treatment<- as.factor(dopamine$treatment)
```

Le jeu de donn√©es dopamine comprend 2 variables dont la variable facteur `treatment` qui comprend 2 niveaux. 

```{r, echo = TRUE}
levels(dopamine$treatment)
```

### Description graphique 

Repr√©sentez graphiquement la concentration en dopamine en fonction du traitement administr√© √† l'aide de boites de dispersion.

```{r tolu_plot_h3, exercise = TRUE, exercise.setup = "prepare_toluene"}
chart(data = ___, ___ ~ ___) +
  geom____()
```

```{r tolu_plot_h3-hint-1}
# Pour r√©aliser des boites de dispersion la fonction geom_boxplot()
# Si vous avez des doutes sur votre compr√©hension des boites de dispersion, 
# relisez le module 3 de sdd1
chart(data = ___, ___ ~ ___) +
  geom_boxplot()
```

```{r tolu_plot_h3-hint-2}
chart(data = dopamine, ___ ~ ___) +
  geom_boxplot()
#### ATTENTION: Hint suivant = solution !####
```

```{r tolu_plot_h3-solution}
chart(data = dopamine, concentration ~ treatment) +
  geom_boxplot()
```

```{r tolu_plot_h3-check}
grade_code("Bien jou√© ! Vous avez propos√© le graphique correct.", "Oups, il semble que vous n'avez pas obtenu le bon graphique. N'h√©sitez pas √† jeter un coup d'oeil aux indices.")
```

### Test de Wilcoxon-Mahn-Withney

Lorsque que vos observations ne sont **peu nombreuses** et/ou que ces derni√®res ne suivent **pas une distribution normal** vous pouvez faire le choix de r√©aliser une version non-param√©trique du test de student. Il s'agit du test de Wilcoxon-Mahn-Withney.


üí¨ **Le code propos√© ci-dessous correspond au snippet `.hnwilkindep`**

```{r, echo = TRUE, eval=FALSE}
wilcox.test(data = DF, YNUM ~ XFACTOR,
  alternative = "two.sided", conf.level = 0.95)
```

Comme vous pouvez vous en apercevoir l'instruction est assez similaire √† la fonction t.test(). Le test de Wilcoxon-Mahn-Withney est la variante non param√©trique du test de Student. 

R√©alisez le test de Wilcoxon-Mahn-Withney bilat√©ral au seuil alpha de 0.05 sur les donn√©es li√©es √† la concentration en dopamine 

```{r tolu_wmw_h2, exercise = TRUE, exercise.setup = "prepare_toluene"}
wilcox.test(data = ___, ___ ~ ___,
  alternative = "___", conf.level = ___)
```

```{r tolu_wmw_h2-hint-1}
wilcox.test(data = ___, ___ ~ ___,
  alternative = "two.sided", conf.level = 0.95)
```

```{r tolu_wmw_h2-solution}
wilcox.test(data = dopamine, concentration ~ treatment,
  alternative = "two.sided", conf.level = 0.95)
```

```{r tolu_wmw_h2-check}
grade_code("Bien jou√© ! Vous avez propos√© le bon test.", "Oups, il semble que vous n'avez pas obtenu le bon r√©sultat. N'h√©sitez pas √† jeter un coup d'oeil aux indices.")
```

R√©pondez aux questions ci-dessous en analysant les r√©sultats du test de Wilcoxon-Mahn-Withney.

```{r tolu_quiz}
quiz(
  question("Est ce que le concentration en dopamine est similaire entre le groupe contr√¥le et le groupe mis en contact avec le tolu√®ne ?",
           answer("oui"),
           answer("non", correct = TRUE),
           allow_retry = TRUE,
           incorrect = "Vous vous √™tes tromp√©. Pour savoir si vous devez rejeter $H_0$, il faut comparer la valeur de p au seuil $\alpha$  d√©fini avant de r√©aliser le test.",
           correct = "Bravo, c'est correct. Vous ne rejettez pas le $H_0$ au seuil $\alpha$ de 0.05"),
  question("Rejettez vous $H_0$ ?",
           answer("oui", correct = TRUE),
           answer("non"),
           allow_retry = TRUE,
           incorrect = "Recommencez afin de trouver la bonne r√©ponse",
           correct = "Bravo, c'est correct")
)
```


## Puissance d'un test d'hypoth√®se


```{r puissance_quiz}
quiz(
  question("Rejetter $H_0$ lorsque $H_0$ est vraie est :",
         answer("correct"),
         answer("Une erreur de premi√®re esp√®ce associ√©e au risque $\\alpha$", correct = TRUE),
         answer("une erreur de seconde esp√®ce associ√©e au risque $\\beta$"),
           allow_retry = TRUE,
           incorrect = "Recommencez afin de trouver la bonne r√©ponse",
           correct = "Bravo, c'est correct"),
  question("Ne pas rejetter $H_0$ lorsque $H_0$ est vraie est",
         answer("correct", correct = TRUE),
         answer("Une erreur de premi√®re esp√®ce associ√©e au risque $\\alpha$"),
         answer("une erreur de seconde esp√®ce associ√©e au risque $\\beta$"),
           allow_retry = TRUE,
           incorrect = "Recommencez afin de trouver la bonne r√©ponse",
           correct = "Bravo, c'est correct"),
  question("Ne pas rejetter $H_0$ lorsque $H_0$ est fausse est",
         answer("correct"),
         answer("Une erreur de premi√®re esp√®ce associ√©e au risque $\\alpha$"),
         answer("une erreur de seconde esp√®ce associ√©e au risque $\\beta$", correct = TRUE),
           allow_retry = TRUE,
           incorrect = "Recommencez afin de trouver la bonne r√©ponse",
           correct = "Bravo, c'est correct")
  )
```


## Conclusion

Bravo\ ! Vous venez de v√©rifier votre bonne compr√©hension du test de Student et du test de Wilcoxon-Mahn-Withney. Si certaines questions vous semblaient plus difficiles, revoyez la th√©orie correspondante avant de progresser dans la mati√®re.

```{r comm_noscore, echo=FALSE}
question_text(
  "Laissez-nous vos impressions sur ce learnr",
  answer("", TRUE, message = "Pas de commentaires... C'est bien aussi."),
  incorrect = "Vos commentaires sont enregistr√©s.",
  placeholder = "Entrez vos commentaires ici...",
  allow_retry = TRUE
)
```

