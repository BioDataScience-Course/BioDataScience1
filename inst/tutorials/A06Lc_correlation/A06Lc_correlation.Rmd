---
title: "Corr√©lation"
author: "Guyliann Engels & Philippe Grosjean"
description: "**SDD I Module 6** Coefficients et tests de corr√©lation."
output:
  learnr::tutorial
tutorial:
  id: "A06Lc_correlation"
  version: 3.0.0/5
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
BioDataScience1::learnr_setup()
SciViews::R("infer", lang = "fr")
# Required for RSConnect
# SciViews::R
library(rlang)
library(data.table)
library(ggplot2)
library(tibble)
library(tidyr)
library(dplyr)
library(dtplyr)
library(broom)
library(forcats)
library(collapse)
library(fs)
library(data.trame)
library(svFast)
library(svTidy)
library(svMisc)
library(svBase)
library(svFlow)
library(data.io)
library(chart)
library(tabularise)
library(SciViews)
# ... more
library(readxl)
library(testthat)
library(equatags)
library(distributional)
library(inferit)
library(BioDataScience)
library(BioDataScience1)
```

```{r, echo=FALSE}
BioDataScience1::learnr_banner()
```

```{r, context="server"}
if (Sys.info()["user"] == "rstudio-connect") {
  options(learnr_user_id = session$user)
  assignInNamespace("default_user_id", function() {
    getOption("learnr_user_id", unname(Sys.info()["user"]))
  }, ns = "learnr")
}
BioDataScience1::learnr_server(input, output, session)
```

------------------------------------------------------------------------

## Objectifs

L'association entre deux variables peut √™tre quantifi√©e gr√¢ce √† diff√©rents descripteurs ou indices comme la covariance, l'indice de corr√©lation de Pearson, l'indice de corr√©lation de Spearman ou de Kendall.

On d√©finit trois niveaux d'association impliquant des hypoth√®ses de plus en plus fortes sur les m√©canismes sous-jacents liant ces deux variables¬†: **corr√©lation**, **relation** et **causalit√©**.

La corr√©lation est l'association de deux variables sans √©laborer plus d'hypoth√®ses sur les m√©canismes √©ventuellement responsables de cette association.

Dans ce tutoriel, vous allez pouvoir auto√©valuer votre capacit√© √†¬†:

-   comprendre les diff√©rents niveaux d'association de deux variables num√©riques

-   r√©aliser et interpr√©ter un test de corr√©lation

## Biom√©trie de trois esp√®ces d'iris

L'√©tude porte sur les variations morphologiques des fleurs de trois esp√®ces d'iris qui sont *Iris setosa* Pall. ex Link (1820) , *Iris versicolor* L. (1753) et *Iris virginica* L. Ces esp√®ces appartiennent √† la famille des *Iridaceae*. Ces trois esp√®ces se d√©veloppent dans des milieux humides.

Edgar Anderson a r√©colt√© des mesures sur les fleurs des trois esp√®ces d'iris en Gasp√©sie (Qu√©bec, Canada) en 1935. La p√©ninsule de Gasp√©sie est entour√©e par l'estuaire du fleuve Saint-Laurent, le golfe du Saint-Laurent et la baie des Chaleurs.

Cinquante plants par esp√®ce sont pr√©lev√©s afin d'√©tudier leurs fleurs. Les longueurs et largeurs des p√©tales et des s√©pales sont mesur√©es (en centim√®tre).

![](images/iris.jpg)

Vous avez √† votre disposition un jeu de donn√©es sur des mesures biom√©triques d'`iris`.

```{r, echo=TRUE}
# Importation des donn√©es
(iris <- read("iris", package = "datasets", lang = "fr"))
```

La fonction `skim()` du package {skimr} est tr√®s int√©ressante dans un carnet de notes pour d√©couvrir les donn√©es. Avec une seule fonction, on se fait rapidement une premi√®re id√©e sur le nombre d'observations, le type des variables, la pr√©sence de valeurs manquantes...

```{r, echo=TRUE}
skimr::skim(iris)
```

Le jeu de donn√©es `iris` est parfaitement balanc√© avec 50 individus par groupe. Il contient quatre variables num√©riques et une variable facteur non ordonn√©e. Il ne contient pas de valeurs manquantes.

```{r iris_prepa}
iris <- read("iris", package = "datasets", lang = "FR")
```

Avant de poursuivre votre exploration des donn√©es, r√©alisez par vous-m√™me diff√©rents graphiques pour d√©couvrir ce jeu de donn√©es dans la zone ci-dessous.

```{r scatterplot_noscore, exercise=TRUE, exercise.setup="iris_prepa"}
chart(data = iris, ___ ~ ___ %col=% species) +
  geom_point()
```

## Matrice de corr√©lation

R√©alisez une matrice de corr√©lation afin de mettre en avant la corr√©lation lin√©aire entre l'ensemble des variables num√©riques disponibles. Effectuez ensuite un r√©sum√© de cette matrice.

<!-- Attention que le snippet se r√©f√®re √† cor() alors qu'on utilise correlation() ici => homog√©n√©iser, ou au moins le pr√©ciser. Ce serait aussi utile de rappeler les variables du tableau en d√©but de cet exercice car on est pass√© √† une autre page! -->

<!-- üí¨ **Un snippet est disponible pour r√©aliser une matrice de corr√©lation √† l'aide d'une fonction diff√©rente `.escor: correlation matrix`.** -->

```{r is_corr_h2, exercise=TRUE, exercise.lines=2, exercise.setup="iris_prepa"}
iris_corr <- correlation(___[, ___:___], use = "complete.obs", method = "___")
summary(iris_corr)
```

```{r is_corr_h2-hint-1}
iris_corr <- correlation(DF[, INDEX_EXPRESSION], use = "complete.obs", method = "pearson")
summary(iris_corr)
# La s√©lection se fait sur base des indices des colonnes en R de base.
# Vous ne devez s√©lectionner que les variables num√©riques.

 #### ATTENTION: Hint suivant = solution !####
```

```{r is_corr_h2-solution}
## Solution ##
iris_corr <- correlation(iris[, 1:4], use = "complete.obs", method = "pearson")
summary(iris_corr)
```

```{r is_corr_h2-check}
grade_code("Le r√©sum√© de la matrice de corr√©lation utilise un syst√®me de l√©gende particulier pour mettre en avant les variables les plus corr√©l√©es. Assurez-vous de bien comprendre les symboles utilis√©s ., + ou encore B (explicit√© en derni√®re ligne).")
```

R√©alisez un graphique de votre objet `iris_corr`. N'affichez que la partie inf√©rieure de votre matrice. Tout comme le r√©sum√© de la matrice ne montre que la partie inf√©rieure de la matrice, il n'est pas utile de repr√©senter la matrice compl√®te sous forme graphique, car la matrice est sym√©trique autour de sa diagonale.

```{r iris_corr}
iris <- read("iris", package = "datasets", lang = "FR")
iris_corr <- correlation(iris[, 1:4], use = "complete.obs", method = "pearson")
```

```{r is_plot_h2, exercise=TRUE, exercise.setup="iris_corr"}
___(iris_corr, type = "___")
```

```{r is_plot_h2-hint-1}
plot(iris_corr, type = "___")

#### ATTENTION: Hint suivant = solution !####
```

```{r is_plot_h2-solution}
## Solution ##
plot(iris_corr, type = "lower")
```

```{r is_plot_h2-check}
grade_code("Ce graphique permet d'avoir une information visuelle simple √† analyser. La couleur utilis√©e, l'√©longation de l'ellipse et le sens de l'ellipse sont porteurs d'information sur la corr√©lation entre les paires de variables √©tudi√©es. R√©pondez √† la question suivante.")
```

```{r quiz_corr}
question("Quelles sont les variables les plus fortement corr√©l√©es (s√©lectionnez les deux variables les plus corr√©l√©es) ?",
  answer("sepal_length"),
  answer("sepal_width"),
  answer("petal_length", correct = TRUE),
  answer("petal_width", correct = TRUE),
  allow_retry = TRUE,
  incorrect = "Recommencez afin de trouver la bonne r√©ponse.",
  correct = "Vous avez su d√©coder avec succ√®s votre matrice de corr√©lation.")
```

## Test de corr√©lation

Suite √† votre matrice de corr√©lation lin√©aire avec l'indice de corr√©lation de Pearson, vous avez pu observer que la longueur des p√©tales et la largeur des p√©tales ont un coefficient de corr√©lation sup√©rieur √† 0.9. Cependant, avoir une valeur √©lev√©e ne permet pas d'affirmer que la corr√©lation est **significative** entre ces deux variables. Utilisez un test de corr√©lation de Pearson pour r√©pondre √† la question suivante¬†: **est-ce que la largeur des p√©tales (`petal_width`) et la longueur des p√©tales (`petal_length`) sont significativement corr√©l√©es au seuil alpha de 5%¬†?**

```{r cortest_h2, exercise=TRUE, exercise.lines=3, exercise.setup="iris_prepa"}
cor.test(data = ___, ~ ___ + ___,
  alternative = "two.sided", method = "___")
```

```{r cortest_h2-hint-1}
cor.test(data = iris, ~ ___ + ___,
  alternative = "two.sided", method = "___")

#### ATTENTION: Hint suivant = solution !####
```

```{r cortest_h2-solution}
## Solution ##
cor.test(data = iris, ~ petal_width + petal_length,
  alternative = "two.sided", method = "pearson")
```

```{r cortest_h2-check}
grade_code("Vous venez de r√©aliser un test de corr√©lation de Pearson. Il ne vous reste plus qu'√† r√©pondre √† la question ci-dessous pour vous assurer que vous √™tes capable d'interpr√©ter ce test d'hypoth√®se.")
```

```{r quiz_test}
question("La largeur des p√©tales (`petal_width`) et la longueur des p√©tales (`petal_length`) sont-elles significativement corr√©l√©es au seuil alpha de 5%¬†?",
  answer("Oui", correct = TRUE),
  answer("Non"),
  correct = "Avec une valeur *p* inf√©rieure au seuil alpha de 5%, il y a rejet de l'hypoth√®se nulle.",
  incorrect = "Il semble que vous n'avez pas su correctement interpr√©ter ce test. V√©rifez votre compr√©hension de ses hypoth√®ses nulle et alternative, ainsi que la fa√ßon de d√©cider laquelle favoriser.",
  allow_retry = TRUE)
```

## Conclusion

Bravo¬†! Vous venez de terminer le tutoriel sur la premier niveau d'association de paires de variables qu'est la corr√©lation. Au cours de science des donn√©es II, vous approfondirez ces notions en utilisant la mod√©lisation pour repr√©senter des **relations** entre variables.

```{r comm_noscore, echo=FALSE}
question_text(
  "Laissez-nous vos impressions sur cet outil p√©dagogique",
  answer("", TRUE, message = "Pas de commentaires... C'est bien aussi."),
  incorrect = "Vos commentaires sont enregistr√©s.",
  placeholder = "Entrez vos commentaires ici...",
  allow_retry = TRUE
)
```

```{css, echo=FALSE}
@media print {
  .topics {
    width: 100% !important;
    padding: 0 0.5em 0 !important;
  }
  .topicsContainer, .topicsContainer *, .learnrBanner, .learnrBanner *, .topicActions, .topicActions * {
    display: none !important;
  }
}
```
