---
title: "Graphiques avancés"
subtitle: "Visualisation III"
author: "Guyliann Engels & Philippe Grosjean"
description: "**SDD I Module 4** Exploration de graphiques plus avancés dans R."
tutorial:
  id: "A04a_graphs_adv"
  version: 2.0.0/16
output:
  learnr::tutorial:
    progressive: true
    allow_skip: true
    fig_caption: yes
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
BioDataScience1::learnr_setup()
SciViews::R()
library(BioDataScience)
library(ggridges)
# Dataset
e_mathaei <- data_frame(id = 1:345, variety = c(rep("black", times = 236), rep("purple" , times = 40), rep("brown", times = 35), rep("green", times = 34)))
marphy <- read("marphy", package = "pastecs", lang = "fr")
marphy$Station <- 1:68
crabs <- read("crabs", package = "MASS", lang = "fr")
```

```{r, echo=FALSE}
BioDataScience1::learnr_banner()
```

```{r, context="server"}
BioDataScience1::learnr_server(input, output, session)
```

----

## Objectifs

- Vérifier l'acquisition des notions relatives à la réalisation de graphiques variés.

## Visualisation graphique

La visualisation graphique est le point de départ dans l'analyse de données. 

### Dénombrement d'oursins perforant dans la baie de Tuléar (Madagascar)

La jeu de données nommé `e_mathaei` est un recensement de différentes variétés de l'oursin *Echinometra mathaei*. 

```{r echino_data, echo = TRUE}
e_mathaei <- data_frame(id = 1:345, variety = c(rep("black",  times = 236), 
                                                rep("purple", times = 40), 
                                                rep("brown",  times = 35), 
                                                rep("green",  times = 34)))
# Visualisation de quelques lignes du tableau de données
e_mathaei[c(200, 250, 300, 340), ]
```

Les scientifiques produisent le graphique suivant :

```{r}
chart(e_mathaei, formula = ~ variety) +
  geom_bar() +
  coord_flip()
```

A partir du jeu de donnée `e_mathaei`, reproduisez le graphique ci-dessus représentant le nombre d'oursin pour chacune des variétés (`variety`).

```{r bar1_h3, exercise=TRUE}
chart(___, formula = ~ ___) +
  ___() +
  ___()
```

```{r bar1_h3-hint-1}
chart(DF, formula = ~ ___) +
  geom_bar() +
  ___()
```

```{r bar1_h3-hint-2}
chart(e_mathaei, formula = ~ FACTOR) +
  geom_bar() +
  coord_flip()

#### Attention : solution dans le 'hint' suivant! ####
```

```{r bar1_h3-solution}
chart(e_mathaei, formula = ~ variety) +
  geom_bar() +
  coord_flip()
```

```{r bar1_h3-check}
grade_code("Vous venez de réaliser votre premier graphique en barre. Félicitation !")
```

Les chercheurs hésitent à proposer un graphique en cammembert dans l'article qu'ils écrivent.

```{r}
chart(data = e_mathaei, ~ factor(0) %fill=% variety) +
  geom_bar(width = 1) + 
  coord_polar("y", start = 0) +
  theme_void() +
  scale_fill_viridis_d() +
  labs(fill = "Variety")
```

A partir du jeu de donnée `e_mathaei`, reproduisez le graphique ci-dessus représentant le nombre d'oursin pour chacune des variétés (`variety`).

```{r pie1_h2, exercise=TRUE}
chart(data = DF, ~ ___ %fill=% ___) +
  ___(width = 1) + 
  coord_polar("y", start = 0) +
  theme_void() +
  scale_fill_viridis_d() +
  labs(fill = "Variety")
```

```{r pie1_h2-hint}
chart(data = e_mathaei, ~ factor(0) %fill=% FACTOR) +
  geom___(width = 1) + 
  coord_polar("y", start = 0) +
  theme_void() +
  scale_fill_viridis_d() +
  labs(fill = "Variety")

#### Attention : solution dans le 'hint' suivant! ####
```

```{r pie1_h2-solution}
chart(data = e_mathaei, ~ factor(0) %fill=% variety) +
  geom_bar(width = 1) + 
  coord_polar("y", start = 0) +
  theme_void() +
  scale_fill_viridis_d() +
  labs(fill = "Variety")
```

```{r pie1_h2-check}
grade_code("Vous êtes impressionnant ! Les graphiques n'auront bientôt plus de secrets pour vous.")
```

Les chercheurs souhaitent en plus générer un graphique entièrement en français. 

```{r}
e_mathaei$variety <- factor(e_mathaei$variety, levels = c("black", "brown", "green", "purple"), labels = c("noir", "brun", "vert", "mauve"))

chart(e_mathaei, formula = ~ variety) +
  geom_bar() +
  labs(x = "Variété", y  = "Dénombrement")
```

A partir du jeu de donnée `e_mathaei`, reproduisez le graphique ci-dessus représentant le nombre d'oursin pour chacune des variétés (`variety`). Attention que le graphique doit être entièrement en français !  

```{r bar2_h3, exercise=TRUE}
e_mathaei$variety <- factor(___, levels = ___, labels = ___)

chart(___, formula = ~ ___) +
  ___() +
  ___(x = ___, y  = ___)
```

```{r bar2_h3-hint-1}
e_mathaei$variety <- factor(e_mathaei$___, levels = c(___, ___, ___, ___), labels = c(___, ___, ___, ___))

chart(___, formula = ~ ___) +
  ___() +
  ___(x = ___, y  = ___)
```

```{r bar2_h3-hint-2}
e_mathaei$variety <- factor(e_mathaei$variety, levels = c("black", "brown", "green", "purple"), labels = c("noir", "brun", "vert", "mauve"))

chart(___, formula = ~ ___) +
  geom___() +
  labs(x = ___, y  = ___)

#### Attention : solution dans le 'hint' suivant! ####
```

```{r bar2_h3-solution}
e_mathaei$variety <- factor(e_mathaei$variety, levels = c("black", "brown", "green", "purple"), labels = c("noir", "brun", "vert", "mauve"))

chart(e_mathaei, formula = ~ variety) +
  geom_bar() +
  labs(x = "Variété", y  = "Dénombrement")
```

```{r bar2_h3-check}
grade_code("Vos progrès en R sont époustouflants !")
```

### Biométrie de crabes

Des scientifiques étudient la biométrie de *Leptograpsus variegatus* et ont obtenu le tableau ci-dessous.

```{r crabs_data, echo = TRUE}
(crabs <- read("crabs", package = "MASS", lang = "fr"))
```

Il décident de réaliser le graphique ci-dessous.

```{r}
chart(crabs, length ~ width %color=% sex | species) +
  geom_point()
```

Reproduisez, à partir des données contenues dans `crabs`, le graphique ci-dessus qui représante la longueur de la carapace (`length`) en fonction de sa largeur (`width`) en utilisant le sexe (`sex`) en couleur et l'espèce (`species`) en facette. 

```{r point1_h3, exercise=TRUE}
___(___, ___ ~ ___ ___ ___ | ___) +
  ___()
```

```{r point1_h3-hint-1}
chart(DF, ___ ~ ___ %color=% ___ | ___) +
  geom___()
```

```{r point1_h3-hint-2}
chart(crabs, NUM ~ NUM %color=% FACTOR | FACTOR) +
  geom_point()

#### Attention : solution dans le 'hint' suivant! ####
```

```{r point1_h3-solution}
chart(crabs, length ~ width %color=% sex | species) +
  geom_point()
```

```{r point1_h3-check}
grade_code("Bravo !")
```

Ensuite, les chercheurs proposent le graphique suivant : 

```{r}
give_n <- function(x)
  c(y = max(x) * 1.1, label = length(x)) 

chart(data = crabs, length ~ species %fill=% sex) +
  geom_boxplot() +
  stat_summary(fun.data = give_n, geom = "text", hjust = 0.5,
    position = position_dodge(0.75))
```

A partir du jeu de données `crabs`, reproduisez le graphique en boites de dispersion ci-dessus représentant la longueur de la carapace (`length`) en fonction de l'espèce (`species`) et coloré par le sexe (`sex`). 

```{r boxplot1_h3, exercise=TRUE, exercise.lines=7}
give_n <- function(x)
  c(y = max(x) * 1.1, label = length(x)) 

chart(data = ___, ___ ~ ___ ___ ___) +
  ___() +
  stat_summary(fun.data = ___, geom = "text", hjust = 0.5,
    position = position_dodge(0.75))
```

```{r boxplot1_h3-hint-1}
give_n <- function(x)
  c(y = max(x) * 1.1, label = length(x)) 

chart(data = DF, ___ ~ ___ %fill=% ___) +
  geom___() +
  stat_summary(fun.data = ___, geom = "text", hjust = 0.5,
    position = position_dodge(0.75))
```

```{r boxplot1_h3-hint-2}
give_n <- function(x)
  c(y = max(x) * 1.1, label = length(x)) 

chart(data = crabs, NUM ~ FACTOR %fill=% FACTOR) +
  geom_boxplot() +
  stat_summary(fun.data = give_n, geom = "text", hjust = 0.5,
    position = position_dodge(0.75))

#### Attention : solution dans le 'hint' suivant! ####
```

```{r boxplot1_h3-solution}
give_n <- function(x)
  c(y = max(x) * 1.1, label = length(x)) 

chart(data = crabs, length ~ species %fill=% sex) +
  geom_boxplot() +
  stat_summary(fun.data = give_n, geom = "text", hjust = 0.5,
    position = position_dodge(0.75))
```

```{r boxplot1_h3-check}
grade_code("Vous maitrisez maintenant le code pour réaliser des boxplots et y associer le nombre d'individus par sous-groupe.")
```

Les chercheurs proposent ensuite ce graphique pour décrire les données.

```{r}
chart(crabs, formula = ~ front | species) +
  geom_histogram()
```

Toujours à partir du jeu de données `crabs`, reproduisezle graphique ci-dessus représentant la distribution du lobe frontal (`front`) pour chacune des espèces (`species`)

```{r histo1_h2, exercise=TRUE}
chart(___, formula = ~ ___ | ___) +
  ___()
```

```{r histo1_h2-hint}
chart(DF, formula = ~ NUM | FACTOR) +
  geom_histogram()

#### Attention : solution dans le 'hint' suivant! ####
```

```{r histo1_h2-solution}
chart(crabs, formula = ~ front | species) +
  geom_histogram()
```

```{r histo1_h2-check}
grade_code("Bravo !")
```

Les chercheurs ne sont cependant pas satisfaits de ce graphique et réalisent la version suivante :

```{r}
chart(data = crabs, ~ front %fill=% species | species) +
  # histogramme d'arrière plan en gris ne tenant pas compte de la variable species
  geom_histogram(data = select(crabs, -species), fill = "grey") + 
  geom_histogram(show.legend = FALSE) +
  ylab("Occurences") +
  scale_fill_viridis_d()
```

Reproduisez le graphique ci-dessus, les variables sont les mêmes que pour le graphique précédent.

```{r histo2_h3, exercise=TRUE}
chart(data = ___, ~ ___ ___ ___ ___ ___) +
  # histogramme d'arrière plan en gris ne tenant pas compte de la variable species
  ___(data = select(___, - ___), fill = "grey") + 
  ___(show.legend = ___) +
  ylab("Occurences") +
  scale_fill_viridis_d()
```

```{r histo2_h3-hint-1}
chart(data = DF, ~ ___ %fill=% ___ | ___) +
  # histogramme d'arrière plan en gris ne tenant pas compte de la variable species
  geom___(data = select(DF, - ___), fill = "grey") + 
  geom___(show.legend = ___) +
  ylab("Occurences") +
  scale_fill_viridis_d()
```

```{r histo2_h3-hint-2}
chart(data = DF, ~ NUM %fill=% FACTOR | FACTOR) +
  # histogramme d'arrière plan en gris ne tenant pas compte de la variable species
  geom_histogram(data = select(DF, - FACTOR), fill = "grey") + 
  geom_histogram(show.legend = ___) +
  ylab("Occurences") +
  scale_fill_viridis_d()

#### Attention : solution dans le 'hint' suivant! ####
```

```{r histo2_h3-solution}
chart(data = crabs, ~ front %fill=% species | species) +
  # histogramme d'arrière plan en gris ne tenant pas compte de la variable species
  geom_histogram(data = select(crabs, -species), fill = "grey") + 
  geom_histogram(show.legend = FALSE) +
  ylab("Occurences") +
  scale_fill_viridis_d()
```

```{r histo2_h3-check}
grade_code("Vous maitrisez de mieux en mieux le code. Très belle association entre l'histogramme complet ne tenant pas compte de l'espèce et l'histogramme par espèce.")
```

### Transect entre Nice et la Corse

Les chercheurs réalisent un transect dans la Mer Méditerranée depuis le port de Nice jusqu'à la baie de Calvi en Corse. Ils vont donc réaliser des prélèvements en 68 stations entre ces deux extrêmes.

```{r marphy_data, echo=TRUE}
(marphy <- read("marphy", package = "pastecs"))
marphy$Station <- 1:68
```

Les chercheurs souhaitent tout d'abord représenter la température en fonction des stations.

```{r}
chart(marphy, Temperature ~ Station) +
  geom_line() +
  geom_point() +
  labs(y = "Temperature [C°]")
```

Utilisez les données du jeu de données `marphy` pour reproduire le graphique ci-dessus représenant la température (`Temperature`) en fonction des stations (`Stations`). 

```{r line1_h3, exercise=TRUE}
chart(___, ___ ~ ___) +
  ___() +
  ___() +
  ___(___ = ___)
```

```{r line1_h3-hint-1}
chart(DF, ___ ~ ___) +
  geom___() +
  geom___() +
  labs(___ = ___)
```

```{r line1_h3-hint-2}
chart(marphy, NUM ~ NUM) +
  geom_line() +
  geom_point() +
  labs(y = ___)

#### Attention : solution dans le 'hint' suivant! ####
```

```{r line1_h3-solution}
chart(marphy, Temperature ~ Station) +
  geom_line() +
  geom_point() +
  labs(y = "Temperature [C°]")
```

```{r line1_h3-check}
grade_code("Vous maitrisez maintenant la réalisation d'un nouveau type de graphique.")
```

Les chercheurs souhaitent ensuite représenter la salinté (`Salinity`) en fonction des stations.

```{r}
chart(marphy, Salinity ~ Station) +
  geom_line() +
  geom_point() +
  labs(y = "Salinité")
```

Reproduisez le graphique ci-dessus. 

```{r line2, exercise=TRUE}
chart(___, ___ ~ ___) +
  ___() +
  ___() +
  ___(___ = ___)
```

```{r line2-solution}
chart(marphy, Salinity ~ Station) +
  geom_line() +
  geom_point() +
  labs(y = "Salinité")
```

```{r line2-check}
grade_code("Tout simplement parfait. Et sans proposition d'aide cette fois !")
```

Ils decident pour finir de représenter les deux graphiques ensembles dans une figure composite.

```{r}
a <- chart(marphy, Temperature ~ Station) +
  geom_line() +
  geom_point() +
  labs(y = "Temperature [C°]")

b <- chart(marphy, Salinity ~ Station) +
  geom_line() +
  geom_point() +
  labs(y = "Salinité")

combine_charts(list(a, b))
```

Reproduisez le graphique ci-dessus en utilisant les mêmes variables que pour les graphiques précédents. 

```{r comb1_h3, exercise=TRUE}
# Graphique de la température 
a <- chart(___, ___ ~ ___) +
  ___() +
  ___() +
  ___(___)
# Graphique de la salinité
b <- chart(___, ___ ~ ___) +
  ___() +
  ___() +
  ___(___)
# Combinaison des 2 graphiques
combine_charts(list(___, ___))

```

```{r comb1_h3-hint-1}
# Graphique de la température 
a <- chart(DF, NUM ~ NUM) +
  geom_line() +
  geom_point() +
  labs(___)
# Graphique de la salinité
b <- chart(DF, NUM ~ NUM) +
  geom_line() +
  geom_point() +
  labs(___)
# Combinaison des 2 graphiques
combine_charts(list(___, ___))
```

```{r comb1_h3-hint-2}
# Graphique de la température 
a <- chart(marphy, Temperature ~ Station) +
  geom_line() +
  geom_point() +
  labs(y = "Temperature [C°]")
# Graphique de la salinité
b <- chart(marphy, Salinity ~ Station) +
  geom_line() +
  geom_point() +
  labs(y = "Salinité")
# Combinaison des 2 graphiques
combine_charts(list(___, ___))

#### Attention : solution dans le 'hint' suivant! ####
```

```{r comb1_h3-solution}
# Graphique de la température 
a <- chart(marphy, Temperature ~ Station) +
  geom_line() +
  geom_point() +
  labs(y = "Temperature [C°]")
# Graphique de la salinité
b <- chart(marphy, Salinity ~ Station) +
  geom_line() +
  geom_point() +
  labs(y = "Salinité")
# Combinaison des 2 graphiques
combine_charts(list(a, b))
```

```{r comb1_h3-check}
grade_code("Votre première figure composite est vraiment très réussie.")
```

## QCM

### Choix du graphiques le plus adéquats

Répondez aux questions à choix multiples ci-dessous.

```{r quiz}
quiz(
  question("Lorsque je souhaite représenter une variable numérique en fonction d'une seconde variable numérique, j'utilise",
           answer("un nuage de de points", correct = TRUE),
           answer("une boite de dispersion"),
           answer("un diagramme en violon"),
           answer("un graphique de densité"),
  random_answer_order = TRUE,
  allow_retry = TRUE),
  question("Lorsque je souhaite représenter une variable facteur et donc d'en faire son dénombrement j'utilise",
           answer("un graphique en barres", correct = TRUE),
           answer("un graphique en violon"),
           answer("un graphique en camembert", correct = TRUE),
           answer("un graphique en nuage de points"),
  random_answer_order = TRUE,
  allow_retry = TRUE))

```

### La boite de dispersion

```{r quiz1}
quiz(
  question("La boite de dispersion permet de résumer les données d'une variable numérique, quels sont les descripteurs employés ?",
           answer("la médiane", correct = TRUE),
           answer("la moyenne"),
           answer("l'espace inter-quartile", correct = TRUE),
           answer("la valeur maximale et la valeur minimale", correct = TRUE),
           answer("l'écart-type"),
  random_answer_order = TRUE,
  allow_retry = TRUE),
  question("Sur base de la suite de nombre suivante : 0.1, 4.3, 9.4, 5, 4.9, 2.9, 3.8, 4.2 que vaut la médiane ?",
           answer("4.25", correct = TRUE),
           answer("3.35"),
           answer("4.95"),
           answer("4.2"),
           answer("4.3"),
  random_answer_order = TRUE,
  allow_retry = TRUE),
  question("Sur base de la suite de nombre suivante : 0.1, 4.3, 9.4, 5, 4.9, 2.9, 3.8, 4.2 que vaut le premier quartile ?",
           answer("4.25"),
           answer("3.35", correct = TRUE),
           answer("4.95"),
           answer("3.8"),
           answer("2.9"),
  random_answer_order = TRUE,
  allow_retry = TRUE),
  question("Sur base de la suite de nombre suivante : 0.1, 4.3, 9.4, 5, 4.9, 2.9, 3.8, 4.2 que vaut le troisième quartile ?",
           answer("4.95", correct = TRUE),
           answer("3.35"),
           answer("4.25"),
           answer("3.8"),
           answer("2.9"),
  random_answer_order = TRUE,
  allow_retry = TRUE)
)
```


## Conclusion

Félicitation ! Vous venez de terminer votre séance d'exercices dans un tutoriel "learnr".

Vous maitrisez maintenant tous les outils nécessaire pour la réalisation de la plupart de vos graphiques. 

```{r comm_noscore, echo=FALSE}
question_text(
  "Laissez-nous vos impressions sur ce learnr",
  answer("", TRUE, message = "Pas de commentaires... C'est bien aussi."),
  incorrect = "Vos commentaires sont enregistrés.",
  placeholder = "Entrez vos commentaires ici...",
  allow_retry = TRUE
)
```

