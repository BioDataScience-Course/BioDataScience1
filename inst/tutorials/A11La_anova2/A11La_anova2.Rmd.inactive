---
title: "ANOVA √† deux facteurs"
author: "Guyliann Engels & Philippe Grosjean"
description: "**SDD I Module 11** ANOVA √† deux facteurs (mod√®les simple et complet)."
tutorial:
  id: "A11La_anova2"
  version: 2.2.0/11
output:
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
BioDataScience1::learnr_setup()
SciViews::R("infer", "model", lang = "fr")
# data ----
set.seed(43)
production <- c(12, 13, 14, 11, 10, 13, 14, 12, 11, 10, 10, 12, 12, 13,
  14, 10, 14, 13, 10, 14, 17, 13, 17, 14, 13, 13, 17, 14, 17, 13, 10, 9,
  10, 12, 11, 9, 10, 12, 10, 11, 11, 9, 11, 11, 12, 10, 9, 13, 11, 10,
  13, 12, 11, 15, 14, 11, 15, 13, 14, 12) 
production <- round(production + rnorm(n = length(production), sd = 0.5), 1)

milk_production <- dtx(
  ration = ordered(rep(c("low", "high"), each = 30L), levels = c("low", "high")), 
  food   = factor(rep(rep(c("hay", "grass", "maize silage"), each = 10L), times = 2L)), 
  milk   = production)

milk_production <- labelise(milk_production, 
  label = list(
    ration = "Ration",
    food   = "Type d'alimentation",
    milk   = "Quantit√© de lait"),
  units = list(
    milk = "L/J"
))
```

```{r, echo=FALSE}
BioDataScience1::learnr_banner()
```

```{r, context="server"}
BioDataScience1::learnr_server(input, output, session)
```

------------------------------------------------------------------------

## Objectifs

Lors de la r√©alisation du tutoriel pr√©c√©dent portant sur l'ANOVA √† un facteur, vous avez √©tudi√© une variable r√©ponse quantitative pour diff√©rents niveaux d'une variable explicative qualitative (de classe **factor** dans R). Dans le [module 11](https://wp.sciviews.org/sdd-umons/?iframe=wp.sciviews.org/sdd-umons-2022/variance2.html) du cours, vous avez vu qu'il √©tait √©galement possible de consid√©rer deux variables explicatives facteurs avec une **ANOVA √† deux facteurs**.

Ce tutoriel vous permet d'auto-√©valuer votre aptitude √†¬†:

-   pr√©senter vos donn√©es avant une ANOVA √† deux facteurs

-   effectuer une ANOVA √† deux facteurs

-   interpr√©ter correctement les r√©sultats obtenus

Assurez-vous d'avoir compris les sections [11.1](https://wp.sciviews.org/sdd-umons/?iframe=wp.sciviews.org/sdd-umons-2022/anova-%25C3%25A0-deux-facteurs.html), [11.2](https://wp.sciviews.org/sdd-umons/?iframe=wp.sciviews.org/sdd-umons-2022/mod%25C3%25A8le-sans-interactions.html) et [11.3](https://wp.sciviews.org/sdd-umons/?iframe=wp.sciviews.org/sdd-umons-2022/mod%25C3%25A8le-crois%25C3%25A9-complet.html) du cours. Vous devez √©galement ma√Ætriser les diff√©rentes notions vue dans le [module 10](https://wp.sciviews.org/sdd-umons/?iframe=wp.sciviews.org/sdd-umons-2022/variance.html) relatives √† l'ANOVA √† un facteur.

## Rendement laitier

Dans ce tutoriel, vous allez r√©aliser une analyse visant √† √©tudier l'influence du type et de la quantit√© d'alimentation de vaches sur le rendement laitier.

![](images/rendement_laitier.jpg)

Le jeu de donn√©es `milk_production` contient les variables suivantes¬†:

-   `ration`¬†: la quantit√© d'alimentation apport√©e (`"low"` = ration faible ou `"high"` = ration √©lev√©e)
-   `food`¬†: le type d'alimentation fourni (`"hay"` = foin, `"grass"` = herbe ou `"maize silage"` = ma√Øs ensil√©s)
-   `milk`¬†: la quantit√© de lait produit en L/j

```{r}
glimpse(milk_production)
```

La question √† laquelle vous allez essayer de r√©pondre est la suivante¬†: **le rendement de production de lait varie-t-il en fonction de la ration et du type d'aliment donn√© aux vaches ?**

### Description graphique des donn√©es

Diff√©rents graphiques vous permettent de visualiser les observations de votre jeu de donn√©es avant la r√©alisation de votre ANOVA √† deux facteurs. √Ä partir du jeu de donn√©es (`milk_production`), r√©alisez un premier graphique repr√©sentant la moyenne du rendement de la production de lait (`milk`) en fonction du type d'alimentation (`food`) en utilisant la couleur pour la quantit√© d'alimentation apport√©e (`ration`).

```{r lait_graph_h2, exercise=TRUE}
chart(___, ___ ~ ___ %col=% ___) +
  geom_point(alpha = 0.4, position = position_dodge2(0.4, padding = 0.1)) +
  stat_summary(geom = "point", fun = "mean", position = position_dodge(0.4), size = 4)
```

```{r lait_graph_h2-hint-1}
chart(milk_production, ___ ~ food %col=% ___) +
  geom_point(alpha = 0.4, position = position_dodge2(0.4, padding = 0.1)) +
  stat_summary(geom = "point", fun = "mean", position = position_dodge(0.4), size = 4)

 #### ATTENTION: Hint suivant = solution !####
```

```{r lait_graph_h2-solution}
## Solution ##
chart(milk_production, milk ~ food %col=% ration) +
  geom_point(alpha = 0.4, position = position_dodge2(0.4, padding = 0.1)) +
  stat_summary(geom = "point", fun = "mean", position = position_dodge(0.4), size = 4)
```

```{r lait_graph_h2-check}
grade_code("Le graphique que vous venez de r√©alisez permet de comparer le rendement laitier en fonction de la ration par type d'alimentation. Le choix du nuage de point avec l'ajout de la moyenne est tout indiqu√© lorsque le nombre d'observations est faible. Les aliments ensil√©s semblent mener √† une production plus importante de lait par jour sur le graphique... mais est-ce significatif ?")
```

### Visualisation graphique des interactions

Dans un mod√®le ANOVA √† deux facteurs, il faut aussi consid√©rer que l'effet d'un facteur sur la variable r√©ponse peut √™tre diff√©rent suivant les modalit√©s de l'autre facteur. On parle alors d'**interactions**. Il est possible de les explorer en r√©alisant un graphique des interactions qui vous permet de visualiser les √©carts des moyennes respectives des diff√©rentes sous-populations.

R√©alisez le graphique permettant de visualiser les interactions dans le jeu de donn√©es `milk_production` (variables facteurs `food` et `ration`). Pour cela, vous commencez par calculer la moyenne du rendement par type d'alimentation et par ration (en utilisant les fonction s "tidy"). Ensuite, vous r√©alisez un graphique de ce rendement moyen en fonction du type d'alimentation et de la ration.

```{r interaction_h3, exercise=TRUE}
___ %>.% # regroupement par type d'alimentation et par ration
  ___(., ___, ___) %>.%
  ___(., milk_mean = ___(___)) %>.%  # moyenne du rendement
  ___(.) %>.% # collecter les r√©sultats
  chart(data = ___, ___ ~ ___ %col=% ___ %group=% ___) + # graphique du rendement moyen en fonction du types d'alimentation et par ration
  ___() + # lignes
  ___() # points
```

```{r interaction_h3-hint-1}
DF %>.% # regroupement par type d'alimentation et par ration
  group_by(., FACTOR1, FACTOR2) %>.%
  summarise(., milk_mean = mean(VARNUM)) %>.%  # moyenne du rendement
  collect_dtx(.) %>.% # collecter les r√©sultats
  chart(data = ___, ___ ~ ___ %col=% ___ %group=% ___) + # graphique du rendement moyen en fonction du types d'alimentation et par ration
  ___() + # lignes
  ___() # points
```

```{r interaction_h3-hint-2}
milk_production %>.% # regroupement par type d'alimentation et par ration
  group_by(., food, ration) %>.%
  summarise(., milk_mean = mean(milk)) %>.% # moyenne du rendement
  collect_dtx(.) %>.% # collecter les r√©sultats
  chart(data = ., VARNUM ~ FACTOR1 %col=% FACTOR2 %group=% FACTOR2) +
  ___() + # lignes
  ___() # points

 #### ATTENTION: Hint suivant = solution !####
```

```{r interaction_h3-solution}
## Solution ##
milk_production %>.% # regroupement par type et quantit√© d'alimentation
  group_by(., food, ration) %>.%
  summarise(., milk_mean = mean(milk)) %>.% # moyenne du rendement
  collect_dtx(.) %>.% # collecter les r√©sultats
  chart(data = ., milk_mean ~ food %col=% ration %group=% ration) + 
  geom_line() + # lignes
  geom_point() # points
```

```{r interaction_h3-check}
grade_code("Ce graphique permet d'analyser les interactions entre les variables explicatives (rations et types d'alimentation). Lorsque les segments de droites sont parall√®les ou √† peu pr√®s, il n'y a pas d'interactions. √Ä l'inverse, lorsque les traits ne sont pas parall√®les, il existe probablement une ou plusieurs interactions. Moins les traits sont parall√®les, plus l'interaction est forte. Dans notre cas, nous serions tent√© de penser qu'il n'y a pas d'int√©ractions. Cependant, il reste plus s√ªr de r√©aliser un mod√®le crois√© complet dans un premier temps pour le v√©rifier. Nous pourrons alors nous rabattre sur un mod√®le crois√© sans int√©ractions plus simple, si cela se justifie.")
```

### Description num√©rique (tableau)

Vous pouvez √©galement r√©sumer vos donn√©es sous la forme d'un tableau. √Ä partir du jeu de donn√©es `milk_production`, r√©alisez un tableau r√©sum√© contenant la moyenne et l'√©cart-type du rendement de la production de lait (`milk`) par type d'alimentation (`food`) et par quantit√© des rations (`ration`). Ajoutez √©galement le nombre d'observations par sous-groupe (en utilisant cette fois-ci les fonctions "speedy" et "fast" pour changer).

<!-- üí¨ **Le code ci-dessous correspond au snippet `.hmanova2desc`.** -->

```{r lait_tab_h2, exercise=TRUE}
___ %>.%
  sgroup_by(., ___, ___) %>.%
  ssummarise(., mean = fmean(___), sd = fsd(___), count = fnobs(___)) %>.%
  ___(.)
```

```{r lait_tab_h2-hint-1}
DF %>.%
  sgroup_by(., XFACTOR1, XFACTOR2) %>.%
  ssummarise(., mean = fmean(YNUM), sd = fsd(YNUM), count = fnobs(YNUM)) %>.%
  collect_dtx(.)

 #### ATTENTION: Hint suivant = solution !####
```

```{r lait_tab_h2-solution}
## Solution ##
milk_production %>.%
  sgroup_by(., food, ration) %>.%
  ssummarise(., mean = fmean(milk), sd = fsd(milk), count = fnobs(milk)) %>.%
  collect_dtx(.)
```

```{r lait_tab_h2-check}
grade_code("Le tableau que vous avez obtenu est parfait pour pr√©senter vos donn√©es avant de r√©aliser une ANOVA √† deux facteurs. Les diff√©rences entre les moyennes sont mises en √©vidence, de m√™me q'une relative homog√©n√©it√© des √©carts types (homosc√©dasticit√©, √† confirmer de toute fa√ßon). Le plan d'exp√©rience est balanc√© car nous avons le m√™me nombre d'individus mesur√©s pour chaque condition et aucune valeur manquante. C'est optimal. Attention, ce tableau est en anglais. N'oubliez pas de le traduire si votre rapport est en fran√ßais.")
```

Les graphiques et la tableau que vous venez de r√©aliser vous ont permis de prendre connaissance des donn√©es sur lesquelles vous travaillez. Vous allez maintenant pouvoir passer √† la r√©alisation de votre test d'hypoth√®se. Vous commencez √† avoir l'habitude¬†: avant de pouvoir le r√©aliser, vous allez devoir v√©rifier si les conditions d'application du test sont respect√©es.

### V√©rification des conditions d'applications

Si vous souhaitez r√©aliser une ANOVA √† deux facteurs, vous devez respecter les conditions d'application suivantes¬†:

-   √©chantillon repr√©sentatif,
-   observations ind√©pendantes,
-   une variable r√©ponse quantitative,
-   deux variables explicatives qualitatives √† deux niveaux ou plus,
-   distribution **Normale** des r√©sidus,
-   **homosc√©dasticit√©** (m√™me variance intragroupe).

Pour v√©rifier si l'√©chantillonnage est repr√©sentatif de la population et si les observations sont bien ind√©pendantes les unes des autres, vous pouvez vous r√©f√©rer au protocole exp√©rimental. Dans le cas de cette √©tude, vous consid√©rerez, sur base de la discussion du protocole utilis√© avec les fermiers (consid√©rez que vous l'avez fait), que les individus ont bien √©t√© s√©lectionn√©s par un processus al√©atoire. Consid√©rez aussi que vous constatez que l'attribution des vaches aux niveaux de la ration et du type d'alimentation a √©galement √©t√© r√©alis√©e de mani√®re al√©atoire. Vous avez √©galement constat√© qu'ils n'y a pas de parent√© forc√©e (par ex., les vaches issues de l'ins√©mination par le m√™me taureau qui sont toutes nourries de la m√™me mani√®re).

Le type de variable peut se v√©rifier en consultant les donn√©es, par exemple avec la fonction `str()`, ou en d√©roulant le contenu de l'objet avec le bouton bleu dans l'onglet "environment" de RStudio. Attention de bien vous assurer que les deux variables explicatives que vous utilisez sont bien type facteur non ordonn√© (**factor**) ou facteur ordonn√© (**ordered**) dans R. C'est le cas ici car la `ration` est un facteur ordonn√© (**ordered**) et `food` est un facteur non ordonn√© (**factor**). La variable r√©ponse `milk` est bien num√©rique (**numeric**).

```{r, echo=TRUE}
str(milk_production)
```

Vous devez encore v√©rifier les deux derni√®res conditions sur votre √©chantillon. Les donn√©es par sous-population √©tant en nombre suffisant, vous allez pouvoir appliquer un test permettant de v√©rifier l'homosc√©dasticit√© (homog√©n√©it√© des variances). Vous devrez aussi v√©rifier que la distribution des r√©sidus est Normale. Mais cette √©tape ne peut se fait que plus tard, apr√®s le calcul de l'ANOVA √† deux facteurs mais avant son interpr√©tation (les r√©sidus ne peuvent √™tre calcul√©s qu'apr√®s le mod√®le lui-m√™me, puisqu'il s'agit de l'√©cart entre les observations et les valeurs pr√©dites par le mod√®le, par d√©finition).

### Test de Bartlett

Pour v√©rifier l'homosc√©dasticit√© de vos donn√©es, vous allez utiliser le test de Bartlett. Afin d'interpr√©ter correctement ce test, commencez par poser les hypoth√®ses de d√©part. Le test de Bartlett doit se faire sur toutes les sous-populations. Pour cela, vous pouvez utiliser la fonction `interaction()` en lui renseignant les deux variables explicatives. Cette fonction, calculera pour vous tous les sous-groupes possibles. Elle peut √™tre utilis√©e directement dans la formule.

Effectuez maintenant un test de Bartlett sur les donn√©es du jeu `milk_production` de la quantit√© de lait (`milk`) en fonction du type d'alimentation (`food`) et de la ration (`ration`).

<!-- üí¨ **Le code ci-dessous correspond au snippet `.hvbartlett`.** -->

```{r lait_bart_h2, exercise=TRUE}
bartlett.test(data = ___, ___ ~ ___(___, ___))
```

```{r lait_bart_h2-hint-1}
bartlett.test(data = DF, YNUM ~ interaction(XFACTOR1, XFACTOR2))

 #### ATTENTION: Hint suivant = solution !####
```

```{r lait_bart_h2-solution}
## Solution ##
bartlett.test(data = milk_production, milk ~ interaction(food, ration))
```

```{r lait_bart_h2-check}
grade_code("Vous avez correctement encod√© l'instruction R pour ce test. Saurez-vous l'interpr√©ter en r√©pondant √† la question suivante ? ")
```

```{r lait_bart_quiz}
question("Au seuil alpha de 5%, y a-t-il homosc√©dasticit√© ?",
  answer("Oui", correct = TRUE),
  answer("Non"),
  allow_retry = TRUE,
  random_answer_order = TRUE,
  incorrect = "Avez-vous bien d√©fini les hypoth√®ses H0 et H1 de votre test de Bartlett ?",
  correct = "La valeur P que vous avez obtenue √©tant plus grande que le seuil alpha de 5%, vous ne rejetez donc pas H0 et pouvez consid√©rer qu'il y a homosc√©dasticit√©.")
```

## ANOVA √† deux facteurs

### ANOVA √† deux facteurs avec interactions

Vous allez maintenant pouvoir r√©aliser une ANOVA √† deux facteurs avec interaction.

Comme pour l'ANOVA √† un facteur, vous allez utiliser la fonction `lm()` qui demande un jeu de donn√©es et une formule. Vous assignez le r√©sultat √† `milk_anova` pour utilisation future, et vous appliquez la fonction `anova()` sur l'objet obtenu pour produire le tableau de l'analyse de la variance. Le mod√®le crois√© avec interactions peut s'√©crire de deux mani√®res dans R.

```{r, echo=TRUE, eval=FALSE}
anova(DF_anova <- lm(data = DF, YNUM ~ XFACTOR1 + XFACTOR2 + XFACTOR1:XFACTOR2))
```

o√π `XFACTOR1:XFACTOR2` repr√©sente les interactions entre `XFACTOR1` et `XFACTOR2`.

Ce mod√®le peut aussi √™tre √©crit de mani√®re plus simple en utilisant `*` √† la place du `+` entre les deux variables facteurs ce qui signifiera implicitement de tenir compte √©galement des interactions. Cela donne¬†:

```{r, echo=TRUE, eval=FALSE}
anova(DF_anova <- lm(data = DF, YNUM ~ XFACTOR1 * XFACTOR2))
```

R√©alisez votre mod√®le ANOVA √† deux facteurs avec interactions sur le rendement de lait en fonction du type d'alimentation et de la ration en utilisant la version simplifi√©e de la formule.

<!-- üí¨ **Le code ci-dessous correspond au snippet `.hmanova2`**. -->

```{r lait_interaction_h2, exercise = TRUE}
anova(milk_anova <- lm(data = ___, ___ ~ ___ * ___))
```

```{r lait_interaction_h2-hint-1}
anova(milk_anova <- lm(data = milk_production, ___ ~ ___ * ___))

 #### ATTENTION: Hint suivant = solution !####
```

```{r lait_interaction_h2-solution}
## Solution ##
anova(milk_anova <- lm(data = milk_production, milk ~ food * ration))
```

```{r lait_interaction_h2-check}
grade_code("Vous avez encod√© correctement votre mod√®le. N'oubliez pas qu'avant de pouvoir interpr√©ter vos r√©sultats vous devez v√©rifier la Normalit√© des r√©sidus. Dans cette analyse, les r√©sidus suivent bien une distribution Normale (le test n'est pas repris ici pour rester focalis√© sur l'ANOVA √† deux facteurs elle-m√™me, mais faites comme si vous l'aviez v√©rifi√© avec `chart$qqplot(milk_anova)`). Les conditions d'application de votre ANOVA √† deux facteurs sont donc remplies. Vous pouvez interpr√©ter vos r√©sultats en r√©pondant √† la question ci-dessous.")
```

```{r lait_interaction_quiz}
question("Observez-vous des int√©ractions significatives entre les rations et les types d'alimentation au seuil alpha de 5% ?",
  answer("oui"),
  answer("non", correct = TRUE),
  allow_retry = TRUE,
  incorrect = "L'interpr√©tation que vous avez faite n'est pas la bonne. Retournez voir dans le cours comment se prend la d√©cision du rejet ou non de H0 en comparant la valeur P obtenue au seuil alpha 5% pour le terme d'interactions.",
  correct = "Il n'y a pas d'interactions significatives entre les deux facteurs. Avant de continuez l'analyse, vous allez simplifier le mod√®le en retirant le terme correspondant √† ces interactions (notez que vous pouvez aussi parfaitement interpr√©ter les deux facteurs sur le mod√®le complet si vous pr√©f√©rez, en pratique).")
```

### ANOVA √† deux facteurs sans interactions

Lorsque vous n'avez pas d'interactions significatives, vous pouvez choisir de simplifier votre mod√®le. Votre nouveau mod√®le s'√©crit donc de cette mani√®re :

```{r, echo=TRUE, eval=FALSE}
anova(DF_anova <- lm(data = DF, YNUM ~ XFACTOR1 + XFACTOR2))
```

R√©alisez votre mod√®le ANOVA √† deux facteurs sans interactions sur le rendement de lait en fonction de la ration et du type d'alimentation. Vous placerez votre mod√®le dans `milk_anova2`.

<!-- üí¨ **Le code ci-dessous correspond au snippet `.hmanova2noint`**. -->

```{r lait_croise_h2, exercise=TRUE}
anova(milk_anova2 <- lm(data = ___, ___ ~ ___ + ___))
```

```{r lait_croise_h2-hint-1}
anova(milk_anova2 <- lm(data = lait, ___ ~ ___ + ___))

 #### ATTENTION: Hint suivant = solution !####
```

```{r lait_croise_h2-solution}
## Solution ##
anova(milk_anova2 <- lm(data = milk_production, milk ~ food + ration))
```

```{r lait_croise_h2-check}
grade_code("Vous avez r√©ussi √† simplifier votre mod√®le. Dans cette analyse, les r√©sidus suivent √©galement une distribution Normale (vous faites comme si vous l'avez test√© √† l'aide d'un graphique quantile-quantile avec `chart$qqplot(milk_anova2)` √† ce stade). Les conditions de votre ANOVA √† deux facteurs sont donc remplies. Vous pouvez interpr√©ter vos r√©sultats en r√©pondant aux questions ci-dessous.")
```

```{r lait_croise_quiz}
quiz(
  question("Y a-t-il une diff√©rence significative entre les deux rations au seuil alpha de 5% ?",
    answer("oui", correct = TRUE),
    answer("non"),
    allow_retry = TRUE,
    incorrect = "L'interpr√©tation que vous avez faite n'est pas la bonne. Retournez voir dans le cours comment se prend la d√©cision du rejet ou non de H0 en comparant la valeur P obtenue au seuil alpha de 5%.",
    correct = "Votre interpr√©tation est correcte, il y a bien une diff√©rence significative au seuil alpha de 5% entre les rations donn√©es sur le rendement de lait."),
  question("Y a-t-il une diff√©rence significative entre les trois types d'alimentation au seuil alpha de 5% ?",
    answer("oui", correct = TRUE),
    answer("non"),
    allow_retry = TRUE,
    incorrect = "L'interpr√©tation que vous avez faite n'est pas la bonne. Retournez voir dans le cours comment se prend la d√©cision du rejet ou non de H0 en comparant la valeur P¬® obtenue au seuil alpha 5%.",
    correct = "Votre interpr√©tation est correcte, il y a bien une diff√©rence significative, au seuil alpha de 5%, entre les types d'alimentation donn√©s sur le rendement de lait.")
)
```

## Tests post-hoc

Votre ANOVA √† deux facteurs sans interactions indique qu'il y a une diff√©rence significative entre les rations donn√©es et qu'il y a au moins une des moyennes qui est significativement diff√©rente des autres au seuil $\alpha$ de 5% pour le type d'alimentation. Un test post-hoc de comparaisons multiples vous permettra d'avoir plus de pr√©cision pour les aliments. Il n'est pas n√©cessaire pour les rations : comme il n'y en a que deux, nous savons d'embl√©e o√π se situent la diff√©rence.

<!-- üí¨ **Ce code correspond au snippet `.hmanovamult`** -->

```{r lait_prepa}
milk_anova2 <- lm(data = milk_production, milk ~ food + ration)
```

```{r lait_post_h2, exercise=TRUE, exercise.setup="lait_prepa"}
summary(milk_posthoc2 <- confint(multcomp::glht(milk_anova2,
  linfct = multcomp::mcp(___ = "Tukey")))) # Add a second factor if you want
oma <- par(oma = c(0, 5.1, 0, 0))
plot(milk_posthoc2)
par(oma)
rm(oma)
```

```{r lait_post_h2-hint-1}
summary(milk_posthoc2 <- confint(multcomp::glht(milk_anova2,
  linfct = multcomp::mcp(XFACTOR1 = "Tukey")))) # Add a second factor if you want
oma <- par(oma = c(0, 5.1, 0, 0))
plot(milk_posthoc2)par(oma)
rm(oma)

 #### ATTENTION: Hint suivant = solution !####
```

```{r lait_post_h2-solution}
## Solution ##
summary(milk_posthoc2 <- confint(multcomp::glht(milk_anova2,
  linfct = multcomp::mcp(food = "Tukey")))) # Add a second factor if you want
oma <- par(oma = c(0, 5.1, 0, 0))
plot(milk_posthoc2)
par(oma)
rm(oma)
```

```{r lait_post_h2-check}
grade_code("Le test de comparaison n'est pas vraiment n√©cessaire dans le cas de la variable ration puisque vous n'avez que deux niveaux, mais si vous l'aviez ajout√© dans le code, cela n'aurait fait que le confirmer. Par contre, il prend tout son sens dans le cas de la variable alimentation pour identifier les paires de moyennes qui sont diff√©rentes. Identifiez les niveaux qui sont significativement diff√©rents en r√©pondant √† la question suivante.")
```

```{r lait_post_quiz}
question("Quels sont les niveaux significativement diff√©rents au seuil alpha de 5% pour les types d'aliments ?",
  answer("foin par rapport √† ma√Øs ensil√©", correct = TRUE),
  answer("herbe par rapport √† ma√Øs ensil√©", correct = TRUE),
  answer("herbe par rapport √† foin", correct = FALSE), 
  allow_retry = TRUE, correct = "En effet, la moyennes pour le ma√Øs ensil√© est diff√©rentes de celle du foin et de l'herbe.",
  incorrect = "Votre r√©ponse est peut-√™tre incompl√®te ou vous avez commis une erreur dans l'interpr√©tation. Regardez bien le tableau et le graphique issus de l'analyse post-hoc.")
```

## Conclusion

F√©licitation¬†! Vous avez r√©alis√© une ANOVA √† deux facteurs compl√®te. N'oubliez pas de bien v√©rifier vos conditions d'application de test avant d'interpr√©ter vos r√©sultats. N'h√©sitez pas √† simplifier votre mod√®le lorsque cela s'av√®re n√©cessaire. Bien s√ªr, vous devez v√©rifier la Normalit√© des r√©sidus avec un graphique quantile-quantile exactement de la m√™me fa√ßon que nous l'avons fait pour l'ANOVA √† un facteur dans le tutoriel pr√©c√©dent... Ici, nous avons court-circuit√© cette √©tape pour rester focalis√© sur l'ANOVA et son interpr√©tation¬†! Voici ce que cela donne¬†:

<!-- üí¨ **Il existe une snippet pour vous aider `.hmanovaqqplot`** -->

```{r final_model, echo=FALSE}
milk_anova2 <- lm(data = milk_production, milk ~ food + ration)
```

```{r normality_test, echo=TRUE}
chart$qqplot(milk_anova2)
```

Les points sont proches de la droite, mis √† part une d√©rive en haut √† droite du graphique. La partie basse correspond √† un √©cart classique li√© √† l'√©chantillonnage. Il n'y a pourtant rien de dramatique et comme l'ANOVA est relativement robuste face √† de petites d√©viations de la Normalit√©, nous en concluons donc que les r√©sidus du mod√®le ANOVA √† deux facteurs sans interactions ne s'√©loignent pas de mani√®re probl√©matique d'une distribution Normale. Nous prendrons toutefois les pr√©cautions d'usage si les valeurs *p* sont proches du seuil alpha (transformation pour mieux Normaliser les donn√©es). Nous pouvons consid√©rer (avec le r√©sultat compl√©mentaire du test de Bartlett) que les conditions d'application sont suffisamment bien rencontr√©es. **Notez bien ici la nuance relative √† la robustesse du mod√®le face √† de petites d√©rives qui est importante¬†!**.

Vous trouverez dans la litt√©rature qu'il existe des tests d'hypoth√®se qui permettent de v√©rifier la Normalit√©. Nous pourrions les utiliser ici √©galement. Par exemple, le test de Shapiro-Wilk est un tel test bien connu (H~0~: Normalit√©, H~1~: non-Normalit√©). La fonction `shapiro.test()` effectue cette analyse. L'extraction des r√©sidus du mod√®le se fait avec `resid()`. Cela donne donc¬†:

```{r, echo=FALSE}
shapiro.test(resid(milk_anova2))
```

Nous ne rejetons pas H~0~ (de peu) au seuil alpha de 5%... mais ce test est connu pour √™tre plut√¥t "conservateur" (il rejette difficilement H~0~ dans les situations qui ne sont pas franches). Quoi qu'il en soit, il tend √† confirmer ici que nous pouvons utiliser l'ANOVA √† deux facteurs sur nos donn√©es.

```{r comm_noscore, echo=FALSE}
question_text(
  "Laissez-nous vos impressions sur cet outil p√©dagogique",
  answer("", TRUE, message = "Pas de commentaires... C'est bien aussi."),
  incorrect = "Vos commentaires sont enregistr√©s.",
  placeholder = "Entrez vos commentaires ici...",
  allow_retry = TRUE
)
```
