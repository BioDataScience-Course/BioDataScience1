---
title: "Distributions continues"
author: "Guyliann Engels & Philippe Grosjean"
description: "**SDD I Module 7** Distributions Normale et log-Normale, graphique quantile-quantile."
tutorial:
  id: "A07Lc_distri2"
  version: 2.0.0/7
output:
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
BioDataScience1::learnr_setup()
SciViews::R()
```

```{r, echo=FALSE}
BioDataScience1::learnr_banner()
```

```{r, context="server"}
BioDataScience1::learnr_server(input, output, session)
```

------------------------------------------------------------------------

## Objectifs

La loi de distribution Normale est centrale en statistiques. Ce tutoriel vous permet d'auto-√©valuer vos acquis √† son sujet. Vous allez¬†:

-   V√©rifier que vous comprenez bien la logique des calculs autour de la distribution Normale

-   R√©aliser et interpr√©ter un graphique quantile-quantile

Vous devez avoir √©tudi√© le contenu du [module 7](https://wp.sciviews.org/sdd-umons/?iframe=wp.sciviews.org/sdd-umons-2020/proba.html) du cours, et en particulier les sections relatives √† la [distribution Normale](https://wp.sciviews.org/sdd-umons/?iframe=wp.sciviews.org/sdd-umons-2020/distribution-normale.html) et au [graphique quantile-quantile](https://wp.sciviews.org/sdd-umons/?iframe=wp.sciviews.org/sdd-umons-2020/graphique-quantile-quantile.html). Assurez-vous √©galement au pr√©alable d'√™tre √† l'aise avec le calcul des probabilit√©s (que vous v√©rifiez avec le learnr `BioDataScience1::run("A07La_proba")`).

## Distribution Normale

![](images/para_normal_distribution.jpg)

La distribution Normale (ou Gaussienne) est appel√©e comme cela parce que c'est celle qui se rencontre le plus souvent. Elle s'observe √† chaque fois que le r√©sultat est la somme de petits effets al√©atoires qui se combinent. Elle a une forme caract√©ristique, dite "en cloche".

### Graphique

Employez R pour repr√©senter la densit√© de probabilit√© de la distribution $Y \sim N(10, 3)$.

üí¨ **Ce code correspond au snippet `.indens`** [`.in` = (d)`i`stribution: `n`ormal].

```{r normal1_h2, exercise=TRUE, exercise.lines=10}
# Normal distribution (density probability) with parameters:
.mu <- ___; .s <- ___ #  mu = .mu and sigma = .s
.col <- 1; .add <- FALSE # Plot parameters
.x <- seq(-3.5*.s+.mu, 3.5*.s+.mu, l = 1000)     # Quantiles
.d <- function (x) dnorm(x, mean = .mu, sd = .s) # Distribution function
.q <- function (p) qnorm(p, mean = .mu, sd = .s) # Quantile for lower-tail prob
.label <- bquote(N(.(.mu), .(.s)))               # Curve parameters
curve(.d(x), xlim = range(.x), xaxs = "i", n = 1000, col = .col,
  add = .add, xlab = "Quantiles", ylab = "Probability density") # Curve
abline(h = 0, col = "gray") # Baseline
```

```{r normal1_h2-hint-1}
# Normal distribution (density probability) with parameters:
.mu <- 10; .s <- ___ #  mu = .mu and sigma = .s
.col <- 1; .add <- FALSE # Plot parameters
.x <- seq(-3.5*.s+.mu, 3.5*.s+.mu, l = 1000)     # Quantiles
.d <- function (x) dnorm(x, mean = .mu, sd = .s) # Distribution function
.q <- function (p) qnorm(p, mean = .mu, sd = .s) # Quantile for lower-tail prob
.label <- bquote(N(.(.mu), .(.s)))               # Curve parameters
curve(.d(x), xlim = range(.x), xaxs = "i", n = 1000, col = .col,
  add = .add, xlab = "Quantiles", ylab = "Probability density") # Curve
abline(h = 0, col = "gray") # Baseline

 #### ATTENTION: Hint suivant = solution !####
```

```{r normal1_h2-solution}
# Normal distribution (density probability) with parameters:
.mu <- 10; .s <- 3 #  mu = .mu and sigma = .s
.col <- 1; .add <- FALSE # Plot parameters
.x <- seq(-3.5*.s+.mu, 3.5*.s+.mu, l = 1000)     # Quantiles
.d <- function (x) dnorm(x, mean = .mu, sd = .s) # Distribution function
.q <- function (p) qnorm(p, mean = .mu, sd = .s) # Quantile for lower-tail prob
.label <- bquote(N(.(.mu), .(.s)))               # Curve parameters
curve(.d(x), xlim = range(.x), xaxs = "i", n = 1000, col = .col,
  add = .add, xlab = "Quantiles", ylab = "Probability density") # Curve
abline(h = 0, col = "gray") # Baseline
```

```{r normal1_h2-check}
grade_code("Le code pour obtenir ce graphique est un peu long... mais le snippet est l√† pour vous pr√©remplir la majeure partie !")
```

Ceci est un graphique de base R. Vous avez beaucoup plus utilis√© les graphiques {ggplot2} jusqu'ici. Leurs logiques diff√®rent. Par exemple, pour ajouter un √©l√©ment √† un graphique de base, nous ferons appel √† une instruction suppl√©mentaire *sans* utiliser l'op√©rateur `+`, contrairement √† {ggplot2}.

Ajoutez maintenant le libell√© de la distribution √† c√¥t√© de sa courbe sur le graphique avec la fonction `text()` (derni√®re ligne du code √† compl√©ter). Pour cela, vous devez rajouter ceci √† la fin¬†:

```{r, echo=FALSE, eval=FALSE}
text(.mu-.s, .d(.mu-.s), .label, pos = 2, col = .col) # Label at left
```

üí¨ **Le code ajout√© en derni√®re ligne apr√®s celui qui g√©n√®re le graphique correspond au snippet `.inllabel`.**

```{r normal2_h2, exercise=TRUE, exercise.lines=12}
# Normal distribution (density probability) with parameters:
.mu <- 10; .s <- 3 #  mu = .mu and sigma = .s
.col <- 1; .add <- FALSE # Plot parameters
.x <- seq(-3.5*.s+.mu, 3.5*.s+.mu, l = 1000)     # Quantiles
.d <- function (x) dnorm(x, mean = .mu, sd = .s) # Distribution function
.q <- function (p) qnorm(p, mean = .mu, sd = .s) # Quantile for lower-tail prob
.label <- bquote(N(.(.mu), .(.s)))               # Curve parameters
curve(.d(x), xlim = range(.x), xaxs = "i", n = 1000, col = .col,
  add = .add, xlab = "Quantiles", ylab = "Probability density") # Curve
abline(h = 0, col = "gray") # Baseline  
# Add text on the plot
___ # Label at left
```

```{r normal2_h2-hint-1}
# Normal distribution (density probability) with parameters:
.mu <- 10; .s <- 3 #  mu = .mu and sigma = .s
.col <- 1; .add <- FALSE # Plot parameters
.x <- seq(-3.5*.s+.mu, 3.5*.s+.mu, l = 1000)     # Quantiles
.d <- function (x) dnorm(x, mean = .mu, sd = .s) # Distribution function
.q <- function (p) qnorm(p, mean = .mu, sd = .s) # Quantile for lower-tail prob
.label <- bquote(N(.(.mu), .(.s)))               # Curve parameters
curve(.d(x), xlim = range(.x), xaxs = "i", n = 1000, col = .col,
  add = .add, xlab = "Quantiles", ylab = "Probability density") # Curve
abline(h = 0, col = "gray") # Baseline  
# Add text on the plot
text(___) # Label at left

 #### ATTENTION: Hint suivant = solution !####
```

```{r normal2_h2-solution}
# Normal distribution (density probability) with parameters:
.mu <- 10; .s <- 3 #  mu = .mu and sigma = .s
.col <- 1; .add <- FALSE # Plot parameters
.x <- seq(-3.5*.s+.mu, 3.5*.s+.mu, l = 1000)     # Quantiles
.d <- function (x) dnorm(x, mean = .mu, sd = .s) # Distribution function
.q <- function (p) qnorm(p, mean = .mu, sd = .s) # Quantile for lower-tail prob
.label <- bquote(N(.(.mu), .(.s)))               # Curve parameters
curve(.d(x), xlim = range(.x), xaxs = "i", n = 1000, col = .col,
  add = .add, xlab = "Quantiles", ylab = "Probability density") # Curve
abline(h = 0, col = "gray") # Baseline  
# Add text on the plot
text(.mu-.s, .d(.mu-.s), .label, pos = 2, col = .col) # Label at left
```

```{r normal2_h2-check}
grade_code("D'autres snippets sont √©galement disponibles pour annoter vos graphiques de lois de distributions dans la section `.ia`.")
```

### Calculs avec la loi Normale

Comme pour les autres lois de distributions, il est vital de pouvoir calculer des probabilit√©s en fonctions de quantiles et des quantiles √† partir de probabilit√©s. Nous nous r√©f√©rerons toujours √† la probabilit√©s d'avoir une valeur plus petite (aide √† gauche avec `lower.tail = TRUE`) ou plus grande (aide √† droite avec `lower.tail = FALSE`) que ce quantile. Une aire comprise entre deux quantiles doit se calculer en deux temps (Pr{Q2} - Pr{Q1}).

![](images/maize.jpg)

Vous √©tudiez la croissance de plants de ma√Øs. A partir d'un grand nombre de mesures, vous avez pu d√©terminer que la hauteur de vos plants suit une distribution Normale avec une moyenne de 145 cm et un √©cart type de 22 cm.

Calculez la probabilit√©s d'avoir un plant de ma√Øs de moins de 100 cm de haut dans votre champ.

üí¨ **Ce code correspond au snippet `.inproba`.**

```{r normal3_h3, exercise=TRUE}
pnorm(___, mean = ___, sd = ___, lower.tail = ___)
```

```{r normal3_h3-hint-1}
pnorm(100, mean = ___, sd = ___, lower.tail = ___)
```

```{r normal3_h3-hint-2}
pnorm(100, mean = 145, sd = ___, lower.tail = ___)

 #### ATTENTION: Hint suivant = solution !####
```

```{r normal3_h3-solution}
pnorm(100, mean = 145, sd = 22, lower.tail = TRUE)
```

```{r normal3_h3-check}
grade_code("Ici, c'est bien l'aire √† gauche du quantile 100 cm qui nous int√©resse. Elle correspond √† la probabilit√© qu'un plant soit moins haut que ce quantile et se calcule en sp√©cifiant `lower.tail = FALSE` dans la fonction `pnorm()`.")
```

Calculez la probabilit√©s d'avoir un plant de ma√Øs dont la hauteur est comprise entre 120 et 150 cm en utilisant les aires √† gauche des quantiles.

```{r normal4_h3, exercise=TRUE}
pnorm(___, mean = ___, sd = ___, lower.tail = ___) -
  ___
```

```{r normal4_h3-hint-1}
pnorm(150, mean = ___, sd = ___, lower.tail = ___) -
  pnorm(___, mean = ___, sd = ___, lower.tail = ___)
```

```{r normal4_h3-hint-2}
pnorm(150, mean = ___, sd = ___, lower.tail = ___) -
  pnorm(120, mean = ___, sd = ___, lower.tail = ___)

 #### ATTENTION: Hint suivant = solution !####
```

```{r normal4_h3-solution}
pnorm(150, mean = 145, sd = 22, lower.tail = TRUE) -
  pnorm(120, mean = 145, sd = 22, lower.tail = TRUE)
```

```{r normal4_h3-check}
grade_code("Une aire comprise entre deux quantiles se calcule toujours en soustrayant la plus petite de la plus grande (par rapport aux deux quantiles respectifs). Deux calculs sont possibles : via les aires √† gauche comme ici, ou via les aires √† droite en utilisant `lower.tail = FALSE`.")
```

En partant de la distribution th√©orique $Y \sim N(10, 2.5)$, calculez le quantile d√©limitant une probabilit√©s √† droite de 0.1 (10% des plus grandes observations).

üí¨ **Ce code correspond au snippet `.inquant`.**

```{r normal5_h2, exercise=TRUE}
qnorm(___, mean = ___, sd = __, lower.tail = ___)
```

```{r normal5_h2-hint-1}
qnorm(0.1, mean = ___, sd = ___, lower.tail = ___)

 #### ATTENTION: Hint suivant = solution !####
```

```{r normal5_h2-solution}
qnorm(0.1, mean = 10, sd = 2.5, lower.tail = FALSE)
```

```{r normal5_h2-check}
grade_code("La fonction `qnorm()` calcule un quantile √† partir d'une probabilit√©, contrairement √† `pnorm()` qui calcule une probabilit√© √† partir d'un quantile.")
```

## Graphique quantile-quantile

![](images/crab.jpg)

Utilisez le jeu de donn√©es `crabs` du package {MASS} qui reprend des mesures de la carapace de 200 crabes bleus.

```{r}
SciViews::R()
# Importation des donn√©es
(crabs <- read("crabs", package = "MASS", lang = "fr"))
```

R√©alisez un graphique quantile-quantile visant √† d√©terminer si la longueur de carapace (variable nomm√©e `length`) de ces crabes suit une distribution Normale.

üí¨ **Ce code correspond au snippet `.cuqqnorm`** [`.cu` = `c`hart: `u`nivariate].

```{r qqnorm1_h2, exercise=TRUE}
SciViews::R()
crabs <- read("crabs", package = "MASS", lang = "fr")
car::qqPlot(___[["___"]], distribution = "norm",
  envelope = 0.95, col = "Black", ylab = "Longueur [cm]")
```

```{r qqnorm1_h2-hint-1}
SciViews::R()
crabs <- read("crabs", package = "MASS", lang = "fr")
car::qqPlot(crabs[["___"]], distribution = "norm",
  envelope = 0.95, col = "Black", ylab = "Longueur [cm]")

 #### ATTENTION: Hint suivant = solution !####
```

```{r qqnorm1_h2-solution}
SciViews::R()
crabs <- read("crabs", package = "MASS", lang = "fr")
car::qqPlot(crabs[["length"]], distribution = "norm",
  envelope = 0.95, col = "Black", ylab = "Longueur [cm]")
```

```{r qqnorm1_h2-check}
grade_code("Rappelez-vous de la syntaxe `DF$VAR` pour se r√©f√©rer √† la variable nomm√©e `VAR` dans le dataframe `DF`. Vous voyez ici que `length` suit une distribution Normale parce que tous les points (ou quasi-tous dans d'autres situations) sont √† l'int√©rieur de l'enveloppe de confiance √† 95% repr√©sent√© par les courbes en pointill√©s bleus.")
```

Est-ce que la longueur de carapace suit une distribution log-Normale chez ces m√™mes crabes¬†?

```{r qqnorm2_h2, exercise=TRUE}
SciViews::R()
crabs <- read("crabs", package = "MASS", lang = "fr")
car::qqPlot(___[["___"]], distribution = "___",
  envelope = 0.95, col = "Black", ylab = "Longueur [cm]")
```

```{r qqnorm2_h2-hint-1}
SciViews::R()
crabs <- read("crabs", package = "MASS", lang = "fr")
car::qqPlot(crabs[["___"]], distribution = "lnorm",
  envelope = 0.95, col = "Black", ylab = "Longueur [cm]")

 #### ATTENTION: Hint suivant = solution !####
```

```{r qqnorm2_h2-solution}
SciViews::R()
crabs <- read("crabs", package = "MASS", lang = "fr")
car::qqPlot(crabs[["length"]], distribution = "lnorm",
  envelope = 0.95, col = "Black", ylab = "Longueur [cm]")
```

```{r qqnorm2_h2-check}
  grade_code("Ici, nous utilisons `distribution = \"lnorm\"` au lieu de `\"norm\"`. Dans le cas pr√©sent, la r√©ponse est non. Dans d'autres situations, si c'√©tait le cas √©galement, vous d√©cider pour la distribution log-Normale si les donn√©es n'admettent pas de valeurs n√©gatives (par exemple, des longueurs, des masses ou des concentrations en solution o√π des valeurs n√©gatives sont impossibles).")
```

## Conclusion

La loi Normale est tr√®s importante en statistiques. Elle ne doit plus avoir de secrets pour vous. Comparer la distribution d'un √©chantillon √† une distribution th√©orique comme la loi Normale est une excellente fa√ßon de v√©rifier la distribution des donn√©es.

```{r comm_noscore, echo=FALSE}
question_text(
  "Laissez-nous vos impressions sur cet outil p√©dagogique",
  answer("", TRUE, message = "Pas de commentaires... C'est bien aussi."),
  incorrect = "Vos commentaires sont enregistr√©s.",
  placeholder = "Entrez vos commentaires ici...",
  allow_retry = TRUE
)
```
